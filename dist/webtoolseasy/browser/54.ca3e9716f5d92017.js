(self.webpackChunkwebtoolseasy=self.webpackChunkwebtoolseasy||[]).push([[54],{4054:(x,_,u)=>{"use strict";u.r(_),u.d(_,{ScreenRecorderModule:()=>oe});var h=u(6814),p=u(3403),r=u(5861),i=u(3242),e=u(553),l=u(6636);const d="/tools/screen-recorder",f="Free Screen Recorder With No Watermark | No Time Limit",v="Easy HD Screen recording via our Best Free Online Screen Recorder with or without audio, video from mic and webcam. No watermark and time limit for screen recording.",y=`${e.N.screenshotsBaseUrl}/screen-recorder.png`,C={mainHeading:"Online Screen Recorder",subHeading:"HD Screen Recording With Mic & Camera",navigationUrl:d,pageTitle:f,metaTags:[{name:"description",content:v},{name:"author",content:"Gaurav Kumar Yadav"},{name:"robots",content:"index, follow"},{property:"og:title",content:f},{property:"og:type",content:"website"},{property:"og:url",content:`${e.N.hostname}${d}`},{property:"og:image",content:y},{property:"og:image:secure_url",content:y},{property:"og:description",content:v},{property:"og:site_name",content:"WebToolsEasy"},{property:"twitter:card",content:"summary_large_image"},{property:"twitter:site",content:"@webtoolseasy"},{property:"twitter:title",content:f},{property:"twitter:description",content:v},{property:"twitter:image",content:y}],tags:["screen recorder","screen capture","screen record on mac","screen recorder windows 10","windows screen recorder"],icons:[{iconName:"screen-icon",iconRelativeUrl:"screen.svg"},{iconName:"video-convert-icon",iconRelativeUrl:"video-convert.svg"}],relatedTools:[{applicationId:"videoconverter",displayText:l.x.VIDEO_CONVERTER,iconName:"video-convert-icon",navigateUrl:"/tools/video-converter"}]},E=[{heading:"How to use Screen Recorder?",listData:["To include mic audio & camera video in the recorded video, use provided checkboxes.","Start screen recording using start recording button.","When asked for mic & camera permission then provide the same.","Camera video if included will appear at bottom right corner in the recorded video in 150X150 px box.","Screen recording can be stopped via native stop recording button or use stop recording button on the screen (button will appear once recording starts).","Once recording is stopped then recorded video will be downloaded automatically."]},{heading:"Key features",listData:["Screen recording is 100% free. No registration required. No credit card required.","Unlimited screen recording in HD format i.e no time limit for recording.","Record screen with webcam video & microphone audio.","Pause and resume screen recording.","HD screen recording with no watermark.","Easy to use: No software installation is needed to record screen.","Cross platform: Tool is completely web-based and can be accessed wherever you are, from any computer. It is compatible with all major browsers and OSes, including Windows, macOS, and Linux.","Secure: Screen recording is 100% secure as whole processing is being done at client side only (in host browser) and we don't store any video."]},{heading:"Disclaimer",blockData:["Recorded video will be in WEBM format. To convert in some other format like MP4 you can use our video converter tool to convert the recorded video."]}];function S(n){return new Promise((s,c)=>{n.oncomplete=n.onsuccess=()=>s(n.result),n.onabort=n.onerror=()=>c(n.error)})}let b;function R(){return b||(b=function j(n,s){const c=indexedDB.open(n);c.onupgradeneeded=()=>c.result.createObjectStore(s);const o=S(c);return(a,m)=>o.then(g=>m(g.transaction(s,a).objectStore(s)))}("keyval-store","keyval")),b}function F(n,s=R()){return s("readonly",c=>S(c.get(n)))}function T(n=R()){return n("readwrite",s=>(s.clear(),S(s.transaction)))}var H=u(1273),M=u(1088),G=u(8645),J=u(9773),B=u(6179),t=u(5879),A=u(6593),D=u(617),L=u(3767),Y=u(3681),W=u(4402),N=u(2296),P=u(5986),U=u(5940);function K(n,s){1&n&&(t.TgZ(0,"span",11),t._uU(1,"screen capturing is not supported by host browser"),t.qZA())}function z(n,s){if(1&n){const c=t.EpF();t.TgZ(0,"section",12)(1,"mat-checkbox",13),t.NdJ("change",function(a){t.CHM(c);const m=t.oxw();return t.KtG(m.recorderOptionChange(a,"mic-audio"))}),t._uU(2,"include mic audio"),t.qZA(),t.TgZ(3,"mat-checkbox",13),t.NdJ("change",function(a){t.CHM(c);const m=t.oxw();return t.KtG(m.recorderOptionChange(a,"camera-video"))}),t._uU(4,"include camera video"),t.qZA()()}}function Q(n,s){if(1&n){const c=t.EpF();t.TgZ(0,"button",14),t.NdJ("click",function(){t.CHM(c);const a=t.oxw();return t.KtG(a.startRecording())}),t.TgZ(1,"mat-icon"),t._uU(2,"play_arrow"),t.qZA(),t._uU(3," Start Recording "),t.qZA()}}function $(n,s){if(1&n){const c=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){t.CHM(c);const a=t.oxw();return t.KtG(a.pauseRecording())}),t.TgZ(1,"mat-icon"),t._uU(2,"pause"),t.qZA(),t._uU(3," Pause Recording "),t.qZA()}}function X(n,s){if(1&n){const c=t.EpF();t.TgZ(0,"button",16),t.NdJ("click",function(){t.CHM(c);const a=t.oxw();return t.KtG(a.resumeRecording())}),t.TgZ(1,"mat-icon"),t._uU(2,"play_arrow"),t.qZA(),t._uU(3," Resume Recording "),t.qZA()}}function q(n,s){if(1&n){const c=t.EpF();t.TgZ(0,"button",17),t.NdJ("click",function(){t.CHM(c);const a=t.oxw();return t.KtG(a.stopRecording())}),t.TgZ(1,"mat-icon"),t._uU(2,"stop"),t.qZA(),t._uU(3," Stop Recording "),t.qZA()}}function ee(n,s){1&n&&(t.TgZ(0,"div",18),t._UZ(1,"mat-spinner",19),t.TgZ(2,"span",20),t._uU(3,"preparing video file to download"),t.qZA()())}const te=[{path:"",component:(()=>{var n;class s{constructor(o,a,m,g,w,I,k,V,re,ne,ae){this.titleService=o,this.metaService=a,this.document=m,this.matIconRegistry=g,this.domSanitizer=w,this.renderer=I,this.zoneRef=k,this.breakpointObserver=V,this.metaConfigService=re,this.iconConfigService=ne,this.platformMetaDataService=ae,this.isRecording=!1,this.isProcessingStream=!1,this.isRecPaused=!1,this.timeCounter=0,this.videoChunksIds=[],this.videoFileExtention="webm",this.recorderOptionConfig={webm:{mimeType:"video/webm; codecs=vp9"},mp4:{mimeType:"video/mp4"}},this.cameraVideoOptions={width:150,height:150},this.includeScreenAudio=!1,this.includeMicAudio=!1,this.includeCameraVideo=!1,this.videoChunksCounter=0,this.isSupported=!0,this.destroyed=new G.x,this.applicationConfig=C,this.descriptionData=E,this.iconConfigService.loadCustomIcons(C.icons,this.matIconRegistry,this.domSanitizer),this.metaConfigService.updatePageMetaData(C,this.titleService,this.metaService,this.document),this.breakpointObserver.observe([M.u3.Handset,M.u3.Web]).pipe((0,J.R)(this.destroyed)).subscribe(fe=>{this.isMobile=V.isMatched(`(max-width: ${B.U})`),this.checkCompatibility()}),this.checkCompatibility()}checkCompatibility(){e.N.production&&(this.isSupported=!this.isMobile)}ngOnDestroy(){this.platformMetaDataService.isPlatformBrowser&&T(),this.destroyed.next(),this.destroyed.complete()}resetContextVariables(){this.screenStream=void 0,this.webcamStream=void 0,this.mergedMediaStream=void 0,this.mediaStreamRecorder=void 0,this.videoChunksCounter=0,this.videoChunksIds=[]}startRecording(){var o=this;this.zoneRef.run((0,r.Z)(function*(){o.isRecording=!0,o.resetContextVariables(),yield T();try{o.screenStream=yield o.getScreenStream(),i.j.info(`screen stream dimensions: ${o.getVideoStreamHeightWidth(o.screenStream)}`),o.configureStreamStopListener(o.screenStream)}catch(a){i.j.error("error occured while capturing screen stream"),i.j.error(a),o.stopRecording()}try{(o.includeMicAudio||o.includeCameraVideo)&&(o.webcamStream=yield o.getCameraAndMicStream(),o.configureStreamStopListener(o.webcamStream))}catch(a){i.j.error("error occured while capturing camera or mic media stream"),i.j.error(a),o.stopRecording()}o.webcamStream?(o.mergedMediaStream=o.mergeMediaStreams(o.screenStream,o.webcamStream),o.mergedMediaStream||(i.j.error("error encountered while merging media streams"),o.stopRecording())):o.mergedMediaStream=o.screenStream,o.mergedMediaStream&&o.configureStreamRecorder(o.mergedMediaStream)}))}configureStreamStopListener(o){o.getTracks().forEach(a=>{a.addEventListener("ended",m=>{i.j.info("media stream track has ended"),this.isRecording&&this.stopRecording()})})}mergeMediaStreams(o,a){const m=this.screenStream?.getVideoTracks()[0].getSettings();let w=new H.VideoStreamMerger({width:m.width,height:m.height});return w.addStream(o,{x:0,y:0,width:w.width,height:w.height,mute:!0,index:0}),w.addStream(a,{x:w.width-this.cameraVideoOptions.width,y:w.height-this.cameraVideoOptions.height,width:this.cameraVideoOptions.width,height:this.cameraVideoOptions.height,mute:!1,index:1}),w.start(),w.result}configureStreamRecorder(o){i.j.info("configuring media stream recorder"),this.mediaStreamRecorder=new MediaRecorder(o,this.recorderOptionConfig[this.videoFileExtention]),this.mediaStreamRecorder.ondataavailable=a=>{const m=Date.now();(function Z(n,s,c=R()){c("readwrite",o=>(o.put(s,n),S(o.transaction)))})(m,a.data),this.videoChunksIds.push(m)},this.mediaStreamRecorder.start(s.RECORDER_TIME_SLICE_MS)}getScreenStream(){var o=this;return(0,r.Z)(function*(){const a={video:!0,audio:!1};return o.includeScreenAudio&&(a.audio=!0),navigator.mediaDevices.getDisplayMedia(a)})()}getCameraAndMicStream(){var o=this;return(0,r.Z)(function*(){return navigator.mediaDevices.getUserMedia({video:o.includeCameraVideo,audio:o.includeMicAudio})})()}pauseRecording(){this.mediaStreamRecorder?.pause(),this.isRecPaused=!0}resumeRecording(){this.mediaStreamRecorder?.resume(),this.isRecPaused=!1}stopRecording(){this.mediaStreamRecorder?.stop(),this.screenStream?.getTracks().forEach(o=>o.stop()),this.webcamStream?.getTracks().forEach(o=>o.stop()),this.mergedMediaStream?.getTracks().forEach(o=>o.stop()),this.screenStream&&this.mergedMediaStream&&this.processMediaStream(),this.isRecording=!1}processMediaStream(){var o=this;this.isProcessingStream=!0,setTimeout((0,r.Z)(function*(){try{const a=[];o.videoChunksIds.sort(function(g,w){return g-w});const m=o.videoChunksIds.length;for(let g=0;g<m;g++)a.push(yield F(o.videoChunksIds[g]));yield o.downloadVideoFile("recorded-video-file.webm",new Blob(a,{type:"video/webm"})),o.zoneRef.run(()=>o.isProcessingStream=!1),T()}catch(a){i.j.info("error occured while preparing video file for download"),i.j.error(a),o.zoneRef.run(()=>o.isProcessingStream=!1)}}),s.RECORDING_START_DELAY_MS)}recorderOptionChange(o,a){switch(i.j.info(`recorder option changed: ${a}`),a){case"mic-audio":this.includeMicAudio=o.checked;break;case"camera-video":this.includeCameraVideo=o.checked}}downloadVideoFile(o,a){var m=this;return(0,r.Z)(function*(){const g=m.renderer.createElement("a");m.renderer.setProperty(g,"href",URL.createObjectURL(a)),m.renderer.setProperty(g,"download",o),g.click()})()}getVideoStreamHeightWidth(o){if(o.getVideoTracks().length>0){const a=o.getVideoTracks()[0].getSettings();return`[ height: ${a.height}, width: ${a.width} ]`}return""}}return(n=s).RECORDING_START_DELAY_MS=5e3,n.RECORDER_TIME_SLICE_MS=100,n.\u0275fac=function(o){return new(o||n)(t.Y36(A.Dx),t.Y36(A.h_),t.Y36(h.K0),t.Y36(D.jv),t.Y36(A.H7),t.Y36(t.Qsj),t.Y36(t.R0b),t.Y36(M.Yg),t.Y36(L.F),t.Y36(Y.r),t.Y36(W.H))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-screen-recorder"]],decls:11,vars:7,consts:[[1,"flex-display","flex-column-flow","flex-align-center","full-width","flex-gap-large"],[1,"flex-display","flex-column-flow","flex-center","flex-align-center","full-width","icon-div"],["svgIcon","screen-icon"],["class","error",4,"ngIf"],["class","flex-display recoder-options",4,"ngIf"],[1,"flex-display","flex-row-flow","flex-gap-medium"],["mat-stroked-button","","aria-label","start recording button","color","primary",3,"click",4,"ngIf"],["mat-stroked-button","","aria-label","pause recording button","color","warn",3,"click",4,"ngIf"],["mat-stroked-button","","aria-label","resume recording button","color","accent",3,"click",4,"ngIf"],["mat-raised-button","","aria-label","stop recording button","color","warn",3,"click",4,"ngIf"],["class","flex-display flex-row-flow flex-align-center",4,"ngIf"],[1,"error"],[1,"flex-display","recoder-options"],[3,"change"],["mat-stroked-button","","aria-label","start recording button","color","primary",3,"click"],["mat-stroked-button","","aria-label","pause recording button","color","warn",3,"click"],["mat-stroked-button","","aria-label","resume recording button","color","accent",3,"click"],["mat-raised-button","","aria-label","stop recording button","color","warn",3,"click"],[1,"flex-display","flex-row-flow","flex-align-center"],["color","primary","diameter","30",2,"margin-right","10px"],[1,"bold-text"]],template:function(o,a){1&o&&(t.TgZ(0,"div",0)(1,"div",1),t._UZ(2,"mat-icon",2),t.qZA(),t.YNc(3,K,2,0,"span",3),t.YNc(4,z,5,0,"section",4),t.TgZ(5,"div",5),t.YNc(6,Q,4,0,"button",6),t.YNc(7,$,4,0,"button",7),t.YNc(8,X,4,0,"button",8),t.YNc(9,q,4,0,"button",9),t.qZA(),t.YNc(10,ee,4,0,"div",10),t.qZA()),2&o&&(t.xp6(3),t.Q6J("ngIf",!a.isSupported),t.xp6(1),t.Q6J("ngIf",a.isSupported),t.xp6(2),t.Q6J("ngIf",!a.isRecording&&!a.isProcessingStream&&a.isSupported),t.xp6(1),t.Q6J("ngIf",a.isRecording&&!a.isRecPaused),t.xp6(1),t.Q6J("ngIf",a.isRecording&&a.isRecPaused),t.xp6(1),t.Q6J("ngIf",a.isRecording&&!a.isProcessingStream&&a.isSupported),t.xp6(1),t.Q6J("ngIf",a.isProcessingStream))},dependencies:[h.O5,D.Hw,N.lW,P.oG,U.Ou],styles:[".icon-div[_ngcontent-%COMP%]{height:300px}.icon-div[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:scale(10)}.error[_ngcontent-%COMP%]{color:red;font-size:large;font-style:italic;font-weight:700}@media screen and (max-width: 735px){.icon-div[_ngcontent-%COMP%]{height:150px}.icon-div[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:scale(5)}.recoder-options[_ngcontent-%COMP%]{flex-direction:column}.error[_ngcontent-%COMP%]{font-size:small}}"]}),s})()}];let ie=(()=>{var n;class s{}return(n=s).\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[p.Bz.forChild(te),p.Bz]}),s})(),oe=(()=>{var n;class s{}return(n=s).\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[h.ez,ie,D.Ps,N.ot,P.p9,U.Cq]}),s})()},4402:(x,_,u)=>{"use strict";u.d(_,{H:()=>r});var h=u(6814),p=u(5879);let r=(()=>{var i;class e{constructor(d){this.platformId=d,this.isPlatformBrowser=!0,this.isPlatformBrowser=(0,h.NF)(d)}}return(i=e).\u0275fac=function(d){return new(d||i)(p.LFG(p.Lbi))},i.\u0275prov=p.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),e})()},6636:(x,_,u)=>{"use strict";u.d(_,{o:()=>p,x:()=>h});var h=function(r){return r.VIDEO_CONVERTER="Video Converter",r.SCREEN_RECORDER="Screen Recorder",r.TEXT_COMPARE="Text File Difference",r.UUID_GENERATOR="UUID Generator",r.JWT_DECODER="JWT Decoder",r.IMAGE_COMPRESSOR="Image Compressor",r.JS_FORMATTER="Javascript Formatter",r.JSON_FORMATTER="JSON Formatter",r.HTML_FORMATTER="HTML Formatter",r.CSS_FORMATTER="CSS Formatter",r.JSON_VIEWER="JSON Viewer",r.PASSWORD_GENERATOR="Password Generator",r.BASE64_ENCODE="Base64 Encode",r.BASE64_DECODE="Base64 Decode",r}(h||{});const p=[{applicationId:"passwordgenerator",displayText:h.PASSWORD_GENERATOR,iconName:"password-icon",navigateUrl:"/tools/password-generator"},{applicationId:"videoconverter",displayText:h.VIDEO_CONVERTER,iconName:"video-convert-icon",navigateUrl:"/tools/video-converter"},{applicationId:"screen-recorder",displayText:h.SCREEN_RECORDER,iconName:"screen-icon",navigateUrl:"/tools/screen-recorder"},{applicationId:"textcompare",displayText:h.TEXT_COMPARE,iconName:"comparison-icon",navigateUrl:"/tools/text-compare"},{applicationId:"uuid",displayText:h.UUID_GENERATOR,iconName:"uuid-icon",navigateUrl:"/tools/uuid"},{applicationId:"jwt",displayText:h.JWT_DECODER,iconName:"jwt-icon",navigateUrl:"/tools/jwt"},{applicationId:"imagecompress",displayText:h.IMAGE_COMPRESSOR,iconName:"image-compress-icon",navigateUrl:"/tools/image-compress"},{applicationId:"jsformatter",displayText:h.JS_FORMATTER,iconName:"js-icon",navigateUrl:"/tools/js-formatter"},{applicationId:"jsonformatter",displayText:h.JSON_FORMATTER,iconName:"json-icon",navigateUrl:"/tools/json-formatter"},{applicationId:"jsonviewer",displayText:h.JSON_VIEWER,iconName:"json-icon",navigateUrl:"/tools/json-viewer"},{applicationId:"htmlformatter",displayText:h.HTML_FORMATTER,iconName:"html-icon",navigateUrl:"/tools/html-formatter"},{applicationId:"cssformatter",displayText:h.CSS_FORMATTER,iconName:"css-icon",navigateUrl:"/tools/css-formatter"},{applicationId:"base64encoder",displayText:h.BASE64_ENCODE,iconName:"file-encode-icon",navigateUrl:"/tools/base64-encode"},{applicationId:"base64decoder",displayText:h.BASE64_DECODE,iconName:"file-decode-icon",navigateUrl:"/tools/base64-decode"}]},1273:function(x){x.exports=function(){"use strict";var _={d:function(p,r){for(var i in r)_.o(r,i)&&!_.o(p,i)&&Object.defineProperty(p,i,{enumerable:!0,get:r[i]})},o:function(p,r){return Object.prototype.hasOwnProperty.call(p,r)},r:function(p){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(p,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(p,"__esModule",{value:!0})}},u={};_.r(u),_.d(u,{VideoStreamMerger:function(){return h}});class h{constructor(r){this.width=720,this.height=405,this.fps=25,this._streams=[],this._frameCount=0,this.clearRect=!0,this.started=!1,this.result=null,this.supported=null,this._canvas=null,this._ctx=null,this._videoSyncDelayNode=null,this._audioDestination=null,this._audioCtx=null;const i=window.AudioContext||window.webkitAudioContext,e=!(!window.AudioContext||!(new i).createMediaStreamDestination),l=!!document.createElement("canvas").captureStream;if(!(this.supported=e&&l))return;this.setOptions(r);const d=this._audioCtx=new i,f=this._audioDestination=d?.createMediaStreamDestination();this._videoSyncDelayNode=d.createDelay(5),this._videoSyncDelayNode.connect(f),this._setupConstantNode(),this.started=!1,this.result=null,this._backgroundAudioHack()}setOptions(r){this._audioCtx=(r=r||{}).audioContext||new AudioContext,this.width=r.width||this.width,this.height=r.height||this.width,this.fps=r.fps||this.fps,this.clearRect=void 0===r.clearRect||r.clearRect}setOutputSize(r,i){this.width=r,this.height=i,this._canvas&&(this._canvas.setAttribute("width",this.width.toString()),this._canvas.setAttribute("height",this.height.toString()))}getAudioContext(){return this._audioCtx}getAudioDestination(){return this._audioDestination}getCanvasContext(){return this._ctx}_backgroundAudioHack(){if(this._audioCtx){const r=this._createConstantSource(),i=this._audioCtx.createGain();i&&r&&(i.gain.value=.001,r.connect(i),i.connect(this._audioCtx.destination),r.start())}}_setupConstantNode(){if(this._audioCtx&&this._videoSyncDelayNode){const r=this._createConstantSource();if(r){r.start();const i=this._audioCtx.createGain();i.gain.value=0,r.connect(i),i.connect(this._videoSyncDelayNode)}}}_createConstantSource(){if(this._audioCtx){if(this._audioCtx.createConstantSource)return this._audioCtx.createConstantSource();const r=this._audioCtx.createBufferSource(),i=this._audioCtx.createBuffer(1,1,this._audioCtx.sampleRate);return i.getChannelData(0)[0]=10,r.buffer=i,r.loop=!0,r}}updateIndex(r,i){"string"==typeof r&&(r={id:r}),i=i??0;for(let e=0;e<this._streams.length;e++)r.id===this._streams[e].id&&(this._streams[e].index=i);this._sortStreams()}_sortStreams(){this._streams=this._streams.sort((r,i)=>r.index-i.index)}addMediaElement(r,i,e){if((e=e||{}).x=e.x||0,e.y=e.y||0,e.width=e.width||this.width,e.height=e.height||this.height,e.mute=e.mute||e.muted||!1,e.oldDraw=e.draw,e.oldAudioEffect=e.audioEffect,e.draw=i instanceof HTMLVideoElement||i instanceof HTMLImageElement?(l,d,f)=>{e.oldDraw?e.oldDraw(l,i,f):(l.drawImage(i,e.x,e.y,null==e.width?this.width:e.width,null==e.height?this.height:e.height),f())}:null,this._audioCtx&&!e.mute){const l=i._mediaElementSource||this._audioCtx.createMediaElementSource(i);i._mediaElementSource=l,l.connect(this._audioCtx.destination);const d=this._audioCtx.createGain();l.connect(d),(i instanceof HTMLVideoElement||i instanceof HTMLAudioElement)&&i.muted?(i.muted=!1,i.volume=.001,d.gain.value=1e3):d.gain.value=1,e.audioEffect=(f,v)=>{e.oldAudioEffect?e.oldAudioEffect(d,v):d.connect(v)},e.oldAudioEffect=null}this.addStream(r,e)}addStream(r,i){if("string"==typeof r)return this._addData(r,i);const e={isData:!1};e.x=(i=i||{}).x||0,e.y=i.y||0,e.width=i.width,e.height=i.height,e.draw=i.draw||null,e.mute=i.mute||i.muted||!1,e.audioEffect=i.audioEffect||null,e.index=null==i.index?0:i.index,e.hasVideo=r.getVideoTracks().length>0,e.hasAudio=r.getAudioTracks().length>0;let l=null;for(let d=0;d<this._streams.length;d++)this._streams[d].id===r.id&&(l=this._streams[d].element);l||(l=document.createElement("video"),l.autoplay=!0,l.muted=!0,l.playsInline=!0,l.srcObject=r,l.setAttribute("style","position:fixed; left: 0px; top:0px; pointer-events: none; opacity:0;"),document.body.appendChild(l),l.play().catch(null),e.hasAudio&&this._audioCtx&&!e.mute&&(e.audioSource=this._audioCtx.createMediaStreamSource(r),e.audioOutput=this._audioCtx.createGain(),e.audioOutput.gain.value=1,e.audioEffect?e.audioEffect(e.audioSource,e.audioOutput):e.audioSource.connect(e.audioOutput),e.audioOutput.connect(this._videoSyncDelayNode))),e.element=l,e.id=r.id||null,this._streams.push(e),this._sortStreams()}removeStream(r){"string"==typeof r&&(r={id:r});for(let i=0;i<this._streams.length;i++){const e=this._streams[i];r.id===e.id&&(e.audioSource&&(e.audioSource=null),e.audioOutput&&(e.audioOutput.disconnect(this._videoSyncDelayNode),e.audioOutput=null),e.element&&e.element.remove(),this._streams[i]=null,this._streams.splice(i,1),i--)}}_addData(r,i){const e={isData:!0};e.draw=(i=i||{}).draw||null,e.audioEffect=i.audioEffect||null,e.id=r,e.element=null,e.index=null==i.index?0:i.index,this._videoSyncDelayNode&&this._audioCtx&&e.audioEffect&&(e.audioOutput=this._audioCtx.createGain(),e.audioOutput.gain.value=1,e.audioEffect(null,e.audioOutput),e.audioOutput.connect(this._videoSyncDelayNode)),this._streams.push(e),this._sortStreams()}_requestAnimationFrame(r){let i=!1;const e=setInterval(()=>{!i&&document.hidden&&(i=!0,clearInterval(e),r())},1e3/this.fps);requestAnimationFrame(()=>{i||(i=!0,clearInterval(e),r())})}start(){var r,i,e,l,d;this._canvas=document.createElement("canvas"),this._canvas.setAttribute("width",this.width.toString()),this._canvas.setAttribute("height",this.height.toString()),this._canvas.setAttribute("style","position:fixed; left: 110%; pointer-events: none"),this._ctx=this._canvas.getContext("2d"),this.started=!0,this._requestAnimationFrame(this._draw.bind(this)),this.result=(null===(r=this._canvas)||void 0===r?void 0:r.captureStream(this.fps))||null;const f=null===(i=this.result)||void 0===i?void 0:i.getAudioTracks()[0];f&&(null===(e=this.result)||void 0===e||e.removeTrack(f));const v=null===(l=this._audioDestination)||void 0===l?void 0:l.stream.getAudioTracks();v&&v.length&&(null===(d=this.result)||void 0===d||d.addTrack(v[0]))}_updateAudioDelay(r){this._videoSyncDelayNode&&this._audioCtx&&this._videoSyncDelayNode.delayTime.setValueAtTime(r/1e3,this._audioCtx.currentTime)}_draw(){var r;if(!this.started)return;this._frameCount++;let i=0;this._frameCount%60==0&&(i=performance.now());let e=this._streams.length;const l=()=>{if(e--,e<=0){if(this._frameCount%60==0){const d=performance.now();this._updateAudioDelay(d-i)}this._requestAnimationFrame(this._draw.bind(this))}};this.clearRect&&(null===(r=this._ctx)||void 0===r||r.clearRect(0,0,this.width,this.height)),this._streams.forEach(d=>{d.draw?d.draw(this._ctx,d.element,l):(!d.isData&&d.hasVideo&&this._drawVideo(d.element,d),l())}),0===this._streams.length&&l()}_drawVideo(r,i){var e;const f=i.height||this.height,v=i.width||this.width;let y=i.x||0,C=i.y||0;try{null===(e=this._ctx)||void 0===e||e.drawImage(r,y,C,v,f)}catch(E){console.error(E)}}stop(){var r,i;this.started=!1,this._canvas=null,this._ctx=null,this._streams.forEach(e=>{e.element&&e.element.remove()}),this._streams=[],null===(r=this._audioCtx)||void 0===r||r.close(),this._audioCtx=null,this._audioDestination=null,this._videoSyncDelayNode=null,null===(i=this.result)||void 0===i||i.getTracks().forEach(e=>{e.stop()}),this.result=null}destroy(){this.stop()}}return typeof window<"u"&&(window.VideoStreamMerger=h),u}()}}]);