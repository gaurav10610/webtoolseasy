(self.webpackChunkwebtoolseasy=self.webpackChunkwebtoolseasy||[]).push([[54],{4054:(x,v,h)=>{"use strict";h.r(v),h.d(v,{ScreenRecorderModule:()=>X});var u=h(6814),p=h(3403),i=h(5861),t=h(4930),e=h(553),l=h(6636);const d="/tools/screen-recorder",f="Free Screen Recorder | Screen Recorder for PC | No Watermark",_="Record/capture your PC screen (Windows 10, Mac OS) with microphone audio and camera video for free with no watermark and no time limit. Supports pause and resume.",C=`${e.N.screenshotsBaseUrl}/screen-recorder.png`,y={mainHeading:"Online Screen Recorder",subHeading:"HD Screen Recording With Mic & Camera",navigationUrl:d,pageTitle:f,metaTags:[{name:"description",content:_},{name:"author",content:"Gaurav Kumar Yadav"},{name:"robots",content:"index, follow"},{property:"og:title",content:f},{property:"og:type",content:"website"},{property:"og:url",content:`${e.N.hostname}${d}`},{property:"og:image",content:C},{property:"og:image:secure_url",content:C},{property:"og:description",content:_},{property:"og:site_name",content:"WebToolsEasy"},{property:"twitter:card",content:"summary_large_image"},{property:"twitter:site",content:"@webtoolseasy"},{property:"twitter:title",content:f},{property:"twitter:description",content:_},{property:"twitter:image",content:C}],tags:["screen recorder","screen recorder for pc","screen record on mac","screen and audio recorder","screen capture with audio"],icons:[{iconName:"screen-icon",iconRelativeUrl:"screen.svg"},{iconName:"video-convert-icon",iconRelativeUrl:"video-convert.svg"}],relatedTools:[{applicationId:"videoconverter",displayText:l.x.VIDEO_CONVERTER,iconName:"video-convert-icon",navigateUrl:"/tools/video-converter"}]},E=[{heading:"How to use Screen Recorder For PC?",listData:["To include mic audio & camera video in the recorded video, use provided checkboxes.","Start screen recording using start recording button.","When asked for mic & camera permission then provide the same.","Camera video if included will appear at bottom right corner in the recorded video in 150X150 px box.","Screen recording can be stopped via native stop recording button or use stop recording button on the screen (button will appear once recording starts).","Once recording is stopped then recorded video will be downloaded automatically."]},{heading:"Key features",listData:["Screen recording is 100% free. No registration required. No credit card required.","Unlimited screen recording in HD format i.e no time limit for recording.","Record screen with webcam video & microphone audio.","Pause and resume screen recording.","HD screen recording with no watermark.","Easy to use: No software installation is needed to record screen.","Cross platform: Tool is completely web-based and can be accessed wherever you are, from any computer. It is compatible with all major browsers and OSes, including Windows, macOS, and Linux.","Secure: Screen recording is 100% secure as whole processing is being done at client side only (in host browser) and we don't store any video."]}];function S(n){return new Promise((s,c)=>{n.oncomplete=n.onsuccess=()=>s(n.result),n.onabort=n.onerror=()=>c(n.error)})}let T;function R(){return T||(T=function k(n,s){const c=indexedDB.open(n);c.onupgradeneeded=()=>c.result.createObjectStore(s);const r=S(c);return(a,m)=>r.then(g=>m(g.transaction(s,a).objectStore(s)))}("keyval-store","keyval")),T}function U(n,s=R()){return s("readonly",c=>S(c.get(n)))}function O(n=R()){return n("readwrite",s=>(s.clear(),S(s.transaction)))}var V=h(1273),M=h(1088),G=h(8645),j=h(9773),Z=h(6179),o=h(5879),F=h(3242),I=h(617),A=h(2296),N=h(5986),D=h(5940);function J(n,s){1&n&&o._UZ(0,"mat-icon",11)}function H(n,s){1&n&&(o.TgZ(0,"span",12),o._uU(1,"screen capturing is not supported by host browser"),o.qZA())}function W(n,s){if(1&n){const c=o.EpF();o.TgZ(0,"section",13)(1,"mat-checkbox",14),o.NdJ("change",function(a){o.CHM(c);const m=o.oxw();return o.KtG(m.recorderOptionChange(a,"mic-audio"))}),o._uU(2,"include mic audio"),o.qZA(),o.TgZ(3,"mat-checkbox",14),o.NdJ("change",function(a){o.CHM(c);const m=o.oxw();return o.KtG(m.recorderOptionChange(a,"camera-video"))}),o._uU(4,"include camera video"),o.qZA()()}}function L(n,s){if(1&n){const c=o.EpF();o.TgZ(0,"button",15),o.NdJ("click",function(){o.CHM(c);const a=o.oxw();return o.KtG(a.startRecording())}),o.TgZ(1,"mat-icon"),o._uU(2,"play_arrow"),o.qZA(),o._uU(3," Start Recording "),o.qZA()}}function B(n,s){if(1&n){const c=o.EpF();o.TgZ(0,"button",16),o.NdJ("click",function(){o.CHM(c);const a=o.oxw();return o.KtG(a.pauseRecording())}),o.TgZ(1,"mat-icon"),o._uU(2,"pause"),o.qZA(),o._uU(3," Pause Recording "),o.qZA()}}function Y(n,s){if(1&n){const c=o.EpF();o.TgZ(0,"button",17),o.NdJ("click",function(){o.CHM(c);const a=o.oxw();return o.KtG(a.resumeRecording())}),o.TgZ(1,"mat-icon"),o._uU(2,"play_arrow"),o.qZA(),o._uU(3," Resume Recording "),o.qZA()}}function K(n,s){if(1&n){const c=o.EpF();o.TgZ(0,"button",18),o.NdJ("click",function(){o.CHM(c);const a=o.oxw();return o.KtG(a.stopRecording())}),o.TgZ(1,"mat-icon"),o._uU(2,"stop"),o.qZA(),o._uU(3," Stop Recording "),o.qZA()}}function z(n,s){1&n&&(o.TgZ(0,"div",19),o._UZ(1,"mat-spinner",20),o.TgZ(2,"span",21),o._uU(3,"preparing video file to download"),o.qZA()())}const Q=[{path:"",component:(()=>{var n;class s{constructor(r,a,m,g){this.renderer=r,this.zoneRef=a,this.breakpointObserver=m,this.platformMetaDataService=g,this.isRecording=!1,this.isProcessingStream=!1,this.isRecPaused=!1,this.timeCounter=0,this.videoChunksIds=[],this.videoFileExtention="webm",this.recorderOptionConfig={webm:{mimeType:"video/webm; codecs=vp9"},mp4:{mimeType:"video/mp4"}},this.cameraVideoOptions={width:150,height:150},this.includeScreenAudio=!1,this.includeMicAudio=!1,this.includeCameraVideo=!1,this.videoChunksCounter=0,this.isSupported=!0,this.destroyed=new G.x,this.applicationConfig=y,this.descriptionData=E,this.breakpointObserver.observe([M.u3.Handset,M.u3.Web]).pipe((0,j.R)(this.destroyed)).subscribe(w=>{this.isMobile=m.isMatched(`(max-width: ${Z.U})`),this.checkCompatibility()}),this.checkCompatibility()}checkCompatibility(){e.N.production&&(this.isSupported=!this.isMobile)}ngOnDestroy(){this.platformMetaDataService.isPlatformBrowser&&O(),this.destroyed.next(),this.destroyed.complete()}resetContextVariables(){this.screenStream=void 0,this.webcamStream=void 0,this.mergedMediaStream=void 0,this.mediaStreamRecorder=void 0,this.videoChunksCounter=0,this.videoChunksIds=[]}startRecording(){var r=this;this.zoneRef.run((0,i.Z)(function*(){r.isRecording=!0,r.resetContextVariables(),yield O();try{r.screenStream=yield r.getScreenStream(),t.j.info(`screen stream dimensions: ${r.getVideoStreamHeightWidth(r.screenStream)}`),r.configureStreamStopListener(r.screenStream)}catch(a){t.j.error("error occured while capturing screen stream"),t.j.error(a),r.stopRecording()}try{(r.includeMicAudio||r.includeCameraVideo)&&(r.webcamStream=yield r.getCameraAndMicStream(),r.configureStreamStopListener(r.webcamStream))}catch(a){t.j.error("error occured while capturing camera or mic media stream"),t.j.error(a),r.stopRecording()}r.webcamStream?(r.mergedMediaStream=r.mergeMediaStreams(r.screenStream,r.webcamStream),r.mergedMediaStream||(t.j.error("error encountered while merging media streams"),r.stopRecording())):r.mergedMediaStream=r.screenStream,r.mergedMediaStream&&r.configureStreamRecorder(r.mergedMediaStream)}))}configureStreamStopListener(r){r.getTracks().forEach(a=>{a.addEventListener("ended",m=>{t.j.info("media stream track has ended"),this.isRecording&&this.stopRecording()})})}mergeMediaStreams(r,a){const m=this.screenStream?.getVideoTracks()[0].getSettings();let w=new V.VideoStreamMerger({width:m.width,height:m.height});return w.addStream(r,{x:0,y:0,width:w.width,height:w.height,mute:!0,index:0}),w.addStream(a,{x:w.width-this.cameraVideoOptions.width,y:w.height-this.cameraVideoOptions.height,width:this.cameraVideoOptions.width,height:this.cameraVideoOptions.height,mute:!1,index:1}),w.start(),w.result}configureStreamRecorder(r){t.j.info("configuring media stream recorder"),this.mediaStreamRecorder=new MediaRecorder(r,this.recorderOptionConfig[this.videoFileExtention]),this.mediaStreamRecorder.ondataavailable=a=>{const m=Date.now();(function P(n,s,c=R()){c("readwrite",r=>(r.put(s,n),S(r.transaction)))})(m,a.data),this.videoChunksIds.push(m)},this.mediaStreamRecorder.start(s.RECORDER_TIME_SLICE_MS)}getScreenStream(){var r=this;return(0,i.Z)(function*(){const a={video:!0,audio:!1};return r.includeScreenAudio&&(a.audio=!0),navigator.mediaDevices.getDisplayMedia(a)})()}getCameraAndMicStream(){var r=this;return(0,i.Z)(function*(){return navigator.mediaDevices.getUserMedia({video:r.includeCameraVideo,audio:r.includeMicAudio})})()}pauseRecording(){this.mediaStreamRecorder?.pause(),this.isRecPaused=!0}resumeRecording(){this.mediaStreamRecorder?.resume(),this.isRecPaused=!1}stopRecording(){this.mediaStreamRecorder?.stop(),this.screenStream?.getTracks().forEach(r=>r.stop()),this.webcamStream?.getTracks().forEach(r=>r.stop()),this.mergedMediaStream?.getTracks().forEach(r=>r.stop()),this.screenStream&&this.mergedMediaStream&&this.processMediaStream(),this.isRecording=!1}processMediaStream(){var r=this;this.isProcessingStream=!0,setTimeout((0,i.Z)(function*(){try{const a=[];r.videoChunksIds.sort(function(g,w){return g-w});const m=r.videoChunksIds.length;for(let g=0;g<m;g++)a.push(yield U(r.videoChunksIds[g]));yield r.downloadVideoFile("recorded-video-file.webm",new Blob(a,{type:"video/webm"})),r.zoneRef.run(()=>r.isProcessingStream=!1),O()}catch(a){t.j.info("error occured while preparing video file for download"),t.j.error(a),r.zoneRef.run(()=>r.isProcessingStream=!1)}}),s.RECORDING_START_DELAY_MS)}recorderOptionChange(r,a){switch(t.j.info(`recorder option changed: ${a}`),a){case"mic-audio":this.includeMicAudio=r.checked;break;case"camera-video":this.includeCameraVideo=r.checked}}downloadVideoFile(r,a){var m=this;return(0,i.Z)(function*(){const g=m.renderer.createElement("a");m.renderer.setProperty(g,"href",URL.createObjectURL(a)),m.renderer.setProperty(g,"download",r),g.click()})()}getVideoStreamHeightWidth(r){if(r.getVideoTracks().length>0){const a=r.getVideoTracks()[0].getSettings();return`[ height: ${a.height}, width: ${a.width} ]`}return""}}return(n=s).RECORDING_START_DELAY_MS=5e3,n.RECORDER_TIME_SLICE_MS=100,n.\u0275fac=function(r){return new(r||n)(o.Y36(o.Qsj),o.Y36(o.R0b),o.Y36(M.Yg),o.Y36(F.H))},n.\u0275cmp=o.Xpm({type:n,selectors:[["app-screen-recorder"]],decls:11,vars:8,consts:[[1,"flex-display","flex-column-flow","flex-align-center","full-width","flex-gap-large"],[1,"flex-display","flex-column-flow","flex-center","flex-align-center","full-width","icon-div"],["svgIcon","screen-icon",4,"ngIf"],["class","error",4,"ngIf"],["class","flex-display recoder-options",4,"ngIf"],[1,"flex-display","flex-row-flow","flex-gap-medium"],["mat-stroked-button","","aria-label","start recording button","color","primary",3,"click",4,"ngIf"],["mat-stroked-button","","aria-label","pause recording button","color","warn",3,"click",4,"ngIf"],["mat-stroked-button","","aria-label","resume recording button","color","accent",3,"click",4,"ngIf"],["mat-raised-button","","aria-label","stop recording button","color","warn",3,"click",4,"ngIf"],["class","flex-display flex-row-flow flex-align-center",4,"ngIf"],["svgIcon","screen-icon"],[1,"error"],[1,"flex-display","recoder-options"],[3,"change"],["mat-stroked-button","","aria-label","start recording button","color","primary",3,"click"],["mat-stroked-button","","aria-label","pause recording button","color","warn",3,"click"],["mat-stroked-button","","aria-label","resume recording button","color","accent",3,"click"],["mat-raised-button","","aria-label","stop recording button","color","warn",3,"click"],[1,"flex-display","flex-row-flow","flex-align-center"],["color","primary","diameter","30",2,"margin-right","10px"],[1,"bold-text"]],template:function(r,a){1&r&&(o.TgZ(0,"div",0)(1,"div",1),o.YNc(2,J,1,0,"mat-icon",2),o.qZA(),o.YNc(3,H,2,0,"span",3),o.YNc(4,W,5,0,"section",4),o.TgZ(5,"div",5),o.YNc(6,L,4,0,"button",6),o.YNc(7,B,4,0,"button",7),o.YNc(8,Y,4,0,"button",8),o.YNc(9,K,4,0,"button",9),o.qZA(),o.YNc(10,z,4,0,"div",10),o.qZA()),2&r&&(o.xp6(2),o.Q6J("ngIf",a.platformMetaDataService.isPlatformBrowser),o.xp6(1),o.Q6J("ngIf",!a.isSupported),o.xp6(1),o.Q6J("ngIf",a.isSupported),o.xp6(2),o.Q6J("ngIf",!a.isRecording&&!a.isProcessingStream&&a.isSupported),o.xp6(1),o.Q6J("ngIf",a.isRecording&&!a.isRecPaused),o.xp6(1),o.Q6J("ngIf",a.isRecording&&a.isRecPaused),o.xp6(1),o.Q6J("ngIf",a.isRecording&&!a.isProcessingStream&&a.isSupported),o.xp6(1),o.Q6J("ngIf",a.isProcessingStream))},dependencies:[u.O5,I.Hw,A.lW,N.oG,D.Ou],styles:[".icon-div[_ngcontent-%COMP%]{height:300px}.icon-div[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:scale(10)}.error[_ngcontent-%COMP%]{color:red;font-size:large;font-style:italic;font-weight:700}@media screen and (max-width: 735px){.icon-div[_ngcontent-%COMP%]{height:150px}.icon-div[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:scale(5)}.recoder-options[_ngcontent-%COMP%]{flex-direction:column}.error[_ngcontent-%COMP%]{font-size:small}}"]}),s})()}];let $=(()=>{var n;class s{}return(n=s).\u0275fac=function(r){return new(r||n)},n.\u0275mod=o.oAB({type:n}),n.\u0275inj=o.cJS({imports:[p.Bz.forChild(Q),p.Bz]}),s})(),X=(()=>{var n;class s{}return(n=s).\u0275fac=function(r){return new(r||n)},n.\u0275mod=o.oAB({type:n}),n.\u0275inj=o.cJS({imports:[u.ez,$,I.Ps,A.ot,N.p9,D.Cq]}),s})()},4930:(x,v,h)=>{"use strict";h.d(v,{j:()=>p});var u=h(553);class p{static info(t,...e){u.N.production||(e.length>0?console.info(t,e):console.info(t))}static debug(t,...e){u.N.production||(e.length>0?console.debug(t,e):console.debug(t))}static error(t,...e){e.length>0?console.error(t,e):console.error(t)}}},6636:(x,v,h)=>{"use strict";h.d(v,{o:()=>p,x:()=>u});var u=function(i){return i.VIDEO_CONVERTER="Video to Audio Converter",i.SCREEN_RECORDER="Free Screen Recorder",i.TEXT_COMPARE="Online Text Compare",i.JWT_DECODER="JWT Decoder",i.IMAGE_COMPRESSOR="Free Image Compressor",i.JS_FORMATTER="Online Javascript Formatter",i.JSON_FORMATTER="Online JSON Formatter",i.HTML_FORMATTER="Online HTML Formatter",i.CSS_FORMATTER="Online CSS Formatter",i.JSON_VIEWER="Online JSON Viewer",i.PASSWORD_GENERATOR="Random Password Generator",i.BASE64_ENCODE="Base64 Encoder",i.BASE64_DECODE="Base64 Decoder",i.CRON_GENERATOR="Cron Expression Generator",i.IMAGE_CROPPER="Free Image Cropper",i.UUID_VERSION1_GENERATOR="UUID V1 Generator",i.UUID_VERSION4_GENERATOR="UUID V4 Generator",i.GUID_GENERATOR="GUID Generator",i.MARKDOWN_EDITOR="Markdown Editor",i.WORD_COUNTER="Word Counter",i}(u||{});const p=[{applicationId:"wordcounter",displayText:u.WORD_COUNTER,iconName:"word-icon",navigateUrl:"/tools/word-counter"},{applicationId:"markdowneditor",displayText:u.MARKDOWN_EDITOR,iconName:"markdown-icon",navigateUrl:"/tools/markdown-editor"},{applicationId:"passwordgenerator",displayText:u.PASSWORD_GENERATOR,iconName:"password-icon",navigateUrl:"/tools/password-generator"},{applicationId:"videoconverter",displayText:u.VIDEO_CONVERTER,iconName:"video-convert-icon",navigateUrl:"/tools/video-converter"},{applicationId:"screen-recorder",displayText:u.SCREEN_RECORDER,iconName:"screen-icon",navigateUrl:"/tools/screen-recorder"},{applicationId:"textcompare",displayText:u.TEXT_COMPARE,iconName:"comparison-icon",navigateUrl:"/tools/text-compare"},{applicationId:"jwt",displayText:u.JWT_DECODER,iconName:"jwt-icon",navigateUrl:"/tools/jwt"},{applicationId:"imagecompress",displayText:u.IMAGE_COMPRESSOR,iconName:"image-icon",navigateUrl:"/tools/image-compress"},{applicationId:"jsformatter",displayText:u.JS_FORMATTER,iconName:"js-icon",navigateUrl:"/tools/js-formatter"},{applicationId:"jsonformatter",displayText:u.JSON_FORMATTER,iconName:"json-icon",navigateUrl:"/tools/json-formatter"},{applicationId:"jsonviewer",displayText:u.JSON_VIEWER,iconName:"json-icon",navigateUrl:"/tools/json-viewer"},{applicationId:"htmlformatter",displayText:u.HTML_FORMATTER,iconName:"html-icon",navigateUrl:"/tools/html-formatter"},{applicationId:"cssformatter",displayText:u.CSS_FORMATTER,iconName:"css-icon",navigateUrl:"/tools/css-formatter"},{applicationId:"base64encoder",displayText:u.BASE64_ENCODE,iconName:"file-encode-icon",navigateUrl:"/tools/base64-encode"},{applicationId:"base64decoder",displayText:u.BASE64_DECODE,iconName:"file-decode-icon",navigateUrl:"/tools/base64-decode"},{applicationId:"crongenerator",displayText:u.CRON_GENERATOR,iconName:"cron-icon",navigateUrl:"/tools/cron-expression"},{applicationId:"imagecropper",displayText:u.IMAGE_CROPPER,iconName:"image-icon",navigateUrl:"/tools/crop-image"},{applicationId:"uuidv4",displayText:u.UUID_VERSION4_GENERATOR,iconName:"uuid-icon",navigateUrl:"/tools/uuid-v4-generator"},{applicationId:"uuidv1",displayText:u.UUID_VERSION1_GENERATOR,iconName:"uuid-icon",navigateUrl:"/tools/uuid-v1-generator"},{applicationId:"guid",displayText:u.GUID_GENERATOR,iconName:"uuid-icon",navigateUrl:"/tools/guid-generator"}]},1273:function(x){x.exports=function(){"use strict";var v={d:function(p,i){for(var t in i)v.o(i,t)&&!v.o(p,t)&&Object.defineProperty(p,t,{enumerable:!0,get:i[t]})},o:function(p,i){return Object.prototype.hasOwnProperty.call(p,i)},r:function(p){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(p,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(p,"__esModule",{value:!0})}},h={};v.r(h),v.d(h,{VideoStreamMerger:function(){return u}});class u{constructor(i){this.width=720,this.height=405,this.fps=25,this._streams=[],this._frameCount=0,this.clearRect=!0,this.started=!1,this.result=null,this.supported=null,this._canvas=null,this._ctx=null,this._videoSyncDelayNode=null,this._audioDestination=null,this._audioCtx=null;const t=window.AudioContext||window.webkitAudioContext,e=!(!window.AudioContext||!(new t).createMediaStreamDestination),l=!!document.createElement("canvas").captureStream;if(!(this.supported=e&&l))return;this.setOptions(i);const d=this._audioCtx=new t,f=this._audioDestination=d?.createMediaStreamDestination();this._videoSyncDelayNode=d.createDelay(5),this._videoSyncDelayNode.connect(f),this._setupConstantNode(),this.started=!1,this.result=null,this._backgroundAudioHack()}setOptions(i){this._audioCtx=(i=i||{}).audioContext||new AudioContext,this.width=i.width||this.width,this.height=i.height||this.width,this.fps=i.fps||this.fps,this.clearRect=void 0===i.clearRect||i.clearRect}setOutputSize(i,t){this.width=i,this.height=t,this._canvas&&(this._canvas.setAttribute("width",this.width.toString()),this._canvas.setAttribute("height",this.height.toString()))}getAudioContext(){return this._audioCtx}getAudioDestination(){return this._audioDestination}getCanvasContext(){return this._ctx}_backgroundAudioHack(){if(this._audioCtx){const i=this._createConstantSource(),t=this._audioCtx.createGain();t&&i&&(t.gain.value=.001,i.connect(t),t.connect(this._audioCtx.destination),i.start())}}_setupConstantNode(){if(this._audioCtx&&this._videoSyncDelayNode){const i=this._createConstantSource();if(i){i.start();const t=this._audioCtx.createGain();t.gain.value=0,i.connect(t),t.connect(this._videoSyncDelayNode)}}}_createConstantSource(){if(this._audioCtx){if(this._audioCtx.createConstantSource)return this._audioCtx.createConstantSource();const i=this._audioCtx.createBufferSource(),t=this._audioCtx.createBuffer(1,1,this._audioCtx.sampleRate);return t.getChannelData(0)[0]=10,i.buffer=t,i.loop=!0,i}}updateIndex(i,t){"string"==typeof i&&(i={id:i}),t=t??0;for(let e=0;e<this._streams.length;e++)i.id===this._streams[e].id&&(this._streams[e].index=t);this._sortStreams()}_sortStreams(){this._streams=this._streams.sort((i,t)=>i.index-t.index)}addMediaElement(i,t,e){if((e=e||{}).x=e.x||0,e.y=e.y||0,e.width=e.width||this.width,e.height=e.height||this.height,e.mute=e.mute||e.muted||!1,e.oldDraw=e.draw,e.oldAudioEffect=e.audioEffect,e.draw=t instanceof HTMLVideoElement||t instanceof HTMLImageElement?(l,d,f)=>{e.oldDraw?e.oldDraw(l,t,f):(l.drawImage(t,e.x,e.y,null==e.width?this.width:e.width,null==e.height?this.height:e.height),f())}:null,this._audioCtx&&!e.mute){const l=t._mediaElementSource||this._audioCtx.createMediaElementSource(t);t._mediaElementSource=l,l.connect(this._audioCtx.destination);const d=this._audioCtx.createGain();l.connect(d),(t instanceof HTMLVideoElement||t instanceof HTMLAudioElement)&&t.muted?(t.muted=!1,t.volume=.001,d.gain.value=1e3):d.gain.value=1,e.audioEffect=(f,_)=>{e.oldAudioEffect?e.oldAudioEffect(d,_):d.connect(_)},e.oldAudioEffect=null}this.addStream(i,e)}addStream(i,t){if("string"==typeof i)return this._addData(i,t);const e={isData:!1};e.x=(t=t||{}).x||0,e.y=t.y||0,e.width=t.width,e.height=t.height,e.draw=t.draw||null,e.mute=t.mute||t.muted||!1,e.audioEffect=t.audioEffect||null,e.index=null==t.index?0:t.index,e.hasVideo=i.getVideoTracks().length>0,e.hasAudio=i.getAudioTracks().length>0;let l=null;for(let d=0;d<this._streams.length;d++)this._streams[d].id===i.id&&(l=this._streams[d].element);l||(l=document.createElement("video"),l.autoplay=!0,l.muted=!0,l.playsInline=!0,l.srcObject=i,l.setAttribute("style","position:fixed; left: 0px; top:0px; pointer-events: none; opacity:0;"),document.body.appendChild(l),l.play().catch(null),e.hasAudio&&this._audioCtx&&!e.mute&&(e.audioSource=this._audioCtx.createMediaStreamSource(i),e.audioOutput=this._audioCtx.createGain(),e.audioOutput.gain.value=1,e.audioEffect?e.audioEffect(e.audioSource,e.audioOutput):e.audioSource.connect(e.audioOutput),e.audioOutput.connect(this._videoSyncDelayNode))),e.element=l,e.id=i.id||null,this._streams.push(e),this._sortStreams()}removeStream(i){"string"==typeof i&&(i={id:i});for(let t=0;t<this._streams.length;t++){const e=this._streams[t];i.id===e.id&&(e.audioSource&&(e.audioSource=null),e.audioOutput&&(e.audioOutput.disconnect(this._videoSyncDelayNode),e.audioOutput=null),e.element&&e.element.remove(),this._streams[t]=null,this._streams.splice(t,1),t--)}}_addData(i,t){const e={isData:!0};e.draw=(t=t||{}).draw||null,e.audioEffect=t.audioEffect||null,e.id=i,e.element=null,e.index=null==t.index?0:t.index,this._videoSyncDelayNode&&this._audioCtx&&e.audioEffect&&(e.audioOutput=this._audioCtx.createGain(),e.audioOutput.gain.value=1,e.audioEffect(null,e.audioOutput),e.audioOutput.connect(this._videoSyncDelayNode)),this._streams.push(e),this._sortStreams()}_requestAnimationFrame(i){let t=!1;const e=setInterval(()=>{!t&&document.hidden&&(t=!0,clearInterval(e),i())},1e3/this.fps);requestAnimationFrame(()=>{t||(t=!0,clearInterval(e),i())})}start(){var i,t,e,l,d;this._canvas=document.createElement("canvas"),this._canvas.setAttribute("width",this.width.toString()),this._canvas.setAttribute("height",this.height.toString()),this._canvas.setAttribute("style","position:fixed; left: 110%; pointer-events: none"),this._ctx=this._canvas.getContext("2d"),this.started=!0,this._requestAnimationFrame(this._draw.bind(this)),this.result=(null===(i=this._canvas)||void 0===i?void 0:i.captureStream(this.fps))||null;const f=null===(t=this.result)||void 0===t?void 0:t.getAudioTracks()[0];f&&(null===(e=this.result)||void 0===e||e.removeTrack(f));const _=null===(l=this._audioDestination)||void 0===l?void 0:l.stream.getAudioTracks();_&&_.length&&(null===(d=this.result)||void 0===d||d.addTrack(_[0]))}_updateAudioDelay(i){this._videoSyncDelayNode&&this._audioCtx&&this._videoSyncDelayNode.delayTime.setValueAtTime(i/1e3,this._audioCtx.currentTime)}_draw(){var i;if(!this.started)return;this._frameCount++;let t=0;this._frameCount%60==0&&(t=performance.now());let e=this._streams.length;const l=()=>{if(e--,e<=0){if(this._frameCount%60==0){const d=performance.now();this._updateAudioDelay(d-t)}this._requestAnimationFrame(this._draw.bind(this))}};this.clearRect&&(null===(i=this._ctx)||void 0===i||i.clearRect(0,0,this.width,this.height)),this._streams.forEach(d=>{d.draw?d.draw(this._ctx,d.element,l):(!d.isData&&d.hasVideo&&this._drawVideo(d.element,d),l())}),0===this._streams.length&&l()}_drawVideo(i,t){var e;const f=t.height||this.height,_=t.width||this.width;let C=t.x||0,y=t.y||0;try{null===(e=this._ctx)||void 0===e||e.drawImage(i,C,y,_,f)}catch(E){console.error(E)}}stop(){var i,t;this.started=!1,this._canvas=null,this._ctx=null,this._streams.forEach(e=>{e.element&&e.element.remove()}),this._streams=[],null===(i=this._audioCtx)||void 0===i||i.close(),this._audioCtx=null,this._audioDestination=null,this._videoSyncDelayNode=null,null===(t=this.result)||void 0===t||t.getTracks().forEach(e=>{e.stop()}),this.result=null}destroy(){this.stop()}}return typeof window<"u"&&(window.VideoStreamMerger=u),h}()}}]);