(self.webpackChunkwebtoolseasy=self.webpackChunkwebtoolseasy||[]).push([[54],{6463:(E,v,a)=>{"use strict";a.d(v,{c:()=>f});var c=a(5879),g=a(5282),n=a(6814),e=a(3403),t=a(617);function d(h,x){if(1&h&&(c.TgZ(0,"div",5),c._UZ(1,"mat-icon",6),c.TgZ(2,"a",7),c._uU(3),c.qZA()()),2&h){const _=x.$implicit;c.xp6(1),c.s9C("svgIcon",_.iconName),c.xp6(1),c.s9C("routerLink",_.navigateUrl),c.Q6J("replaceUrl",!0),c.xp6(1),c.Oqu(_.displayText)}}function u(h,x){if(1&h&&(c.TgZ(0,"div",1)(1,"span",2),c._uU(2,"Related Tools"),c.qZA(),c.TgZ(3,"div",3),c.YNc(4,d,4,4,"div",4),c.qZA()()),2&h){const _=c.oxw();c.xp6(4),c.Q6J("ngForOf",_.appContextService.relatedTools)}}let f=(()=>{var h;class x{constructor(C){this.appContextService=C}}return(h=x).\u0275fac=function(C){return new(C||h)(c.Y36(g.i))},h.\u0275cmp=c.Xpm({type:h,selectors:[["app-related-tools"]],decls:1,vars:1,consts:[["class","flex-display flex-column-flow flex-gap-small",4,"ngIf"],[1,"flex-display","flex-column-flow","flex-gap-small"],[2,"font-size","large"],[1,"flex-display","flex-row-flow","flex-wrap","flex-gap-medium"],["class","flex-display flex-row-flow flex-align-center app-parent-div shadow-grey border-grey",4,"ngFor","ngForOf"],[1,"flex-display","flex-row-flow","flex-align-center","app-parent-div","shadow-grey","border-grey"],[2,"margin","10px",3,"svgIcon"],[3,"replaceUrl","routerLink"]],template:function(C,w){1&C&&c.YNc(0,u,5,1,"div",0),2&C&&c.Q6J("ngIf",w.appContextService.relatedTools)},dependencies:[n.sg,n.O5,e.rH,t.Hw],styles:[".app-parent-div[_ngcontent-%COMP%]{padding:5px 10px 5px 5px}"]}),x})()},300:(E,v,a)=>{"use strict";a.d(v,{K:()=>t});var c=a(6814),g=a(3403),n=a(617),e=a(5879);let t=(()=>{var d;class u{}return(d=u).\u0275fac=function(h){return new(h||d)},d.\u0275mod=e.oAB({type:d}),d.\u0275inj=e.cJS({imports:[c.ez,g.Bz,n.Ps]}),u})()},4054:(E,v,a)=>{"use strict";a.r(v),a.d(v,{ScreenRecorderModule:()=>Se});var c=a(6814),g=a(3403),n=a(5861),e=a(5879),t=a(7294),d=a(3242),u=a(553),f=a(6636);const h="/tools/screen-recorder",x="Free Online Screen Recorder | Online Video Recorder",_="Easily Capture your Screen via Best Free Online Screen Recorder with or without audio, video from microphone and webcam | No download, No Watermark with Lag free recording for PCs ( Windows/ MAC/ Ubuntu )",C=`${u.N.screenshotsBaseUrl}/screen-recorder.png`,w={mainHeading:"Online Screen Recorder",subHeading:"Record Screen With Audio, Video for Free",navigationUrl:h,pageTitle:x,metaTags:[{name:"description",content:_},{name:"author",content:"Gaurav Kumar Yadav"},{name:"robots",content:"index, follow"},{property:"og:title",content:x},{property:"og:type",content:"website"},{property:"og:url",content:`${u.N.hostname}${h}`},{property:"og:image",content:C},{property:"og:image:secure_url",content:C},{property:"og:description",content:_},{property:"og:site_name",content:"WebToolsEasy"}],tags:["screen recorder","screen capture","screen record on mac","screen recorder windows 10","windows screen recorder"],icons:[{iconName:"app-icon",iconRelativeUrl:"app-icon.svg"},{iconName:"screen-icon",iconRelativeUrl:"screen.svg"},{iconName:"video-convert-icon",iconRelativeUrl:"video-convert.svg"},{iconName:"share-fb",iconRelativeUrl:"share-fb.svg"},{iconName:"share-linkedin",iconRelativeUrl:"share-linkedin.svg"},{iconName:"share-twitter",iconRelativeUrl:"share-twitter.svg"},{iconName:"share-copy",iconRelativeUrl:"share-copy.svg"},{iconName:"home-icon",iconRelativeUrl:"home.svg"}],relatedTools:[{applicationId:"videoconverter",displayText:f.x.VIDEO_CONVERTER,iconName:"video-convert-icon",navigateUrl:"/tools/video-converter"}]},V=[{heading:"How to use Screen Recorder?",listData:["To include mic audio & camera video in the recorded video, use provided checkboxes.","Start screen recording using start recording button.","When asked for mic & camera permission then provide the same.","Camera video if included will appear at bottom right corner in the recorded video in 150X150 px box.","Screen recording can be stopped via native stop recording button or use stop recording button on the screen (button will appear once recording starts).","Once recording is stopped then recorded video will be downloaded automatically."]},{heading:"Key features",listData:["Screen recording is 100% free.","Unlimited screen recording in HD format.","Record screen with camera video & mic audio.","No watermark in the recorded video.","Easy to use: No software installation is needed to record screen.","Cross platform: tool is completely web-based and can be accessed wherever you are, from any computer. It is compatible with all major browsers and OSes, including Windows, macOS, and Linux.","Secure: Screen recording is 100% secure as whole processing is being done at client side only (in host browser) and we don't store any video."]},{heading:"Disclaimer",blockData:["Recorded video will be in WEBM format. To convert in some other format like MP4 you can use our video converter tool to convert the recorded video."]}];function S(i){return new Promise((s,l)=>{i.oncomplete=i.onsuccess=()=>s(i.result),i.onabort=i.onerror=()=>l(i.error)})}let T;function y(){return T||(T=function F(i,s){const l=indexedDB.open(i);l.onupgradeneeded=()=>l.result.createObjectStore(s);const o=S(l);return(r,m)=>o.then(p=>m(p.transaction(s,r).objectStore(s)))}("keyval-store","keyval")),T}function j(i,s=y()){return s("readonly",l=>S(l.get(i)))}function O(i=y()){return i("readwrite",s=>(s.clear(),S(s.transaction)))}var J=a(1273),M=a(1088),L=a(8645),B=a(9773),W=a(6179),A=a(6593),D=a(617),G=a(5282),K=a(3927),Y=a(9609),N=a(2296),P=a(5986),Z=a(5940),z=a(797),Q=a(2577),$=a(2740),X=a(323),q=a(6463),ee=a(659);function te(i,s){1&i&&(e.TgZ(0,"span",15),e._uU(1,"screen capturing is not supported by host browser"),e.qZA())}function oe(i,s){if(1&i){const l=e.EpF();e.TgZ(0,"section",16)(1,"mat-checkbox",17),e.NdJ("change",function(r){e.CHM(l);const m=e.oxw();return e.KtG(m.recorderOptionChange(r,"mic-audio"))}),e._uU(2,"include mic audio"),e.qZA(),e.TgZ(3,"mat-checkbox",17),e.NdJ("change",function(r){e.CHM(l);const m=e.oxw();return e.KtG(m.recorderOptionChange(r,"camera-video"))}),e._uU(4,"include camera video"),e.qZA()()}}function ne(i,s){if(1&i){const l=e.EpF();e.TgZ(0,"button",18),e.NdJ("click",function(){e.CHM(l);const r=e.oxw();return e.KtG(r.startRecording())}),e.TgZ(1,"mat-icon"),e._uU(2,"play_arrow"),e.qZA(),e._uU(3," Start Recording "),e.qZA()}}function ie(i,s){if(1&i){const l=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(l);const r=e.oxw();return e.KtG(r.pauseRecording())}),e.TgZ(1,"mat-icon"),e._uU(2,"pause"),e.qZA(),e._uU(3," Pause Recording "),e.qZA()}}function re(i,s){if(1&i){const l=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(l);const r=e.oxw();return e.KtG(r.resumeRecording())}),e.TgZ(1,"mat-icon"),e._uU(2,"play_arrow"),e.qZA(),e._uU(3," Resume Recording "),e.qZA()}}function ae(i,s){if(1&i){const l=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(l);const r=e.oxw();return e.KtG(r.stopRecording())}),e.TgZ(1,"mat-icon"),e._uU(2,"stop"),e.qZA(),e._uU(3," Stop Recording "),e.qZA()}}function se(i,s){1&i&&(e.TgZ(0,"div",22),e._UZ(1,"mat-spinner",23),e.TgZ(2,"span",24),e._uU(3,"preparing video file to download"),e.qZA()())}const ce=[{path:"",component:(()=>{var i;class s extends t.H{constructor(o,r,m,p,R,I,U,_e,k,xe){super(),this.titleService=o,this.metaService=r,this.document=m,this.matIconRegistry=p,this.domSanitizer=R,this.platformId=I,this.renderer=U,this.zoneRef=_e,this.breakpointObserver=k,this.appContextService=xe,this.appId="imagecompress",this.isRecording=!1,this.isProcessingStream=!1,this.isRecPaused=!1,this.timeCounter=0,this.videoChunksIds=[],this.videoFileExtention="webm",this.recorderOptionConfig={webm:{mimeType:"video/webm; codecs=vp9"},mp4:{mimeType:"video/mp4"}},this.cameraVideoOptions={width:150,height:150},this.includeScreenAudio=!1,this.includeMicAudio=!1,this.includeCameraVideo=!1,this.videoChunksCounter=0,this.isSupported=!0,this.destroyed=new L.x,this.loadCustomIcons(w.icons,this.matIconRegistry,this.domSanitizer,this.platformId,this.appContextService),this.updatePageMetaData(w,this.titleService,this.metaService,this.document),this.appContextService.tags=w.tags,this.appContextService.mainHeading=w.mainHeading,this.appContextService.subHeading=w.subHeading,this.appContextService.relatedTools=w.relatedTools,this.appContextService.descrptionData=V,this.breakpointObserver.observe([M.u3.Handset,M.u3.Web]).pipe((0,B.R)(this.destroyed)).subscribe(Ae=>{this.isMobile=k.isMatched(`(max-width: ${W.U})`),this.checkCompatibility()}),this.checkCompatibility()}checkCompatibility(){u.N.production&&(this.isSupported=!this.isMobile)}ngOnDestroy(){(0,c.NF)(this.platformId)&&O(),this.destroyed.next(),this.destroyed.complete()}resetContextVariables(){this.screenStream=void 0,this.webcamStream=void 0,this.mergedMediaStream=void 0,this.mediaStreamRecorder=void 0,this.videoChunksCounter=0,this.videoChunksIds=[]}startRecording(){var o=this;this.zoneRef.run((0,n.Z)(function*(){o.isRecording=!0,o.resetContextVariables(),yield O();try{o.screenStream=yield o.getScreenStream(),d.j.info(`screen stream dimensions: ${o.getVideoStreamHeightWidth(o.screenStream)}`),o.configureStreamStopListener(o.screenStream)}catch(r){d.j.error("error occured while capturing screen stream"),d.j.error(r),o.stopRecording()}try{(o.includeMicAudio||o.includeCameraVideo)&&(o.webcamStream=yield o.getCameraAndMicStream(),o.configureStreamStopListener(o.webcamStream))}catch(r){d.j.error("error occured while capturing camera or mic media stream"),d.j.error(r),o.stopRecording()}o.webcamStream?(o.mergedMediaStream=o.mergeMediaStreams(o.screenStream,o.webcamStream),o.mergedMediaStream||(d.j.error("error encountered while merging media streams"),o.stopRecording())):o.mergedMediaStream=o.screenStream,o.mergedMediaStream&&o.configureStreamRecorder(o.mergedMediaStream)}))}configureStreamStopListener(o){o.getTracks().forEach(r=>{r.addEventListener("ended",m=>{d.j.info("media stream track has ended"),this.isRecording&&this.stopRecording()})})}mergeMediaStreams(o,r){const m=this.screenStream?.getVideoTracks()[0].getSettings();let R=new J.VideoStreamMerger({width:m.width,height:m.height});return R.addStream(o,{x:0,y:0,width:R.width,height:R.height,mute:!0,index:0}),R.addStream(r,{x:R.width-this.cameraVideoOptions.width,y:R.height-this.cameraVideoOptions.height,width:this.cameraVideoOptions.width,height:this.cameraVideoOptions.height,mute:!1,index:1}),R.start(),R.result}configureStreamRecorder(o){d.j.info("configuring media stream recorder"),this.mediaStreamRecorder=new MediaRecorder(o,this.recorderOptionConfig[this.videoFileExtention]),this.mediaStreamRecorder.ondataavailable=r=>{const m=Date.now();(function H(i,s,l=y()){l("readwrite",o=>(o.put(s,i),S(o.transaction)))})(m,r.data),this.videoChunksIds.push(m)},this.mediaStreamRecorder.start(s.RECORDER_TIME_SLICE_MS)}getScreenStream(){var o=this;return(0,n.Z)(function*(){const r={video:!0,audio:!1};return o.includeScreenAudio&&(r.audio=!0),navigator.mediaDevices.getDisplayMedia(r)})()}getCameraAndMicStream(){var o=this;return(0,n.Z)(function*(){return navigator.mediaDevices.getUserMedia({video:o.includeCameraVideo,audio:o.includeMicAudio})})()}pauseRecording(){this.mediaStreamRecorder?.pause(),this.isRecPaused=!0}resumeRecording(){this.mediaStreamRecorder?.resume(),this.isRecPaused=!1}stopRecording(){this.mediaStreamRecorder?.stop(),this.screenStream?.getTracks().forEach(o=>o.stop()),this.webcamStream?.getTracks().forEach(o=>o.stop()),this.mergedMediaStream?.getTracks().forEach(o=>o.stop()),this.screenStream&&this.mergedMediaStream&&this.processMediaStream(),this.isRecording=!1}processMediaStream(){var o=this;this.isProcessingStream=!0,setTimeout((0,n.Z)(function*(){try{const r=[];o.videoChunksIds.sort(function(p,R){return p-R});const m=o.videoChunksIds.length;for(let p=0;p<m;p++)r.push(yield j(o.videoChunksIds[p]));yield o.downloadVideoFile("recorded-video-file.webm",new Blob(r,{type:"video/webm"})),o.zoneRef.run(()=>o.isProcessingStream=!1),O()}catch(r){d.j.info("error occured while preparing video file for download"),d.j.error(r),o.zoneRef.run(()=>o.isProcessingStream=!1)}}),s.RECORDING_START_DELAY_MS)}recorderOptionChange(o,r){switch(d.j.info(`recorder option changed: ${r}`),r){case"mic-audio":this.includeMicAudio=o.checked;break;case"camera-video":this.includeCameraVideo=o.checked}}downloadVideoFile(o,r){var m=this;return(0,n.Z)(function*(){const p=m.renderer.createElement("a");m.renderer.setProperty(p,"href",URL.createObjectURL(r)),m.renderer.setProperty(p,"download",o),p.click()})()}getVideoStreamHeightWidth(o){if(o.getVideoTracks().length>0){const r=o.getVideoTracks()[0].getSettings();return`[ height: ${r.height}, width: ${r.width} ]`}return""}}return(i=s).RECORDING_START_DELAY_MS=5e3,i.RECORDER_TIME_SLICE_MS=100,i.\u0275fac=function(o){return new(o||i)(e.Y36(A.Dx),e.Y36(A.h_),e.Y36(c.K0),e.Y36(D.jv),e.Y36(A.H7),e.Y36(e.Lbi),e.Y36(e.Qsj),e.Y36(e.R0b),e.Y36(M.Yg),e.Y36(G.i))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-screen-recorder"]],features:[e.qOj],decls:22,vars:7,consts:[[1,"full-height","flex-display","flex-column-flow","no-y-scroll"],[1,"full-width","y-scroll"],[1,"flex-display","flex-column-flow","flex-align-center","base-app-container","flex-gap-large"],[1,"full-width"],[1,"flex-display","flex-column-flow","flex-align-center","full-width","flex-gap-large"],[1,"flex-display","flex-column-flow","flex-center","flex-align-center","full-width","icon-div"],["svgIcon","screen-icon"],["class","error",4,"ngIf"],["class","flex-display recoder-options",4,"ngIf"],[1,"flex-display","flex-row-flow","flex-gap-medium"],["mat-stroked-button","","aria-label","start recording button","color","primary",3,"click",4,"ngIf"],["mat-stroked-button","","aria-label","pause recording button","color","warn",3,"click",4,"ngIf"],["mat-stroked-button","","aria-label","resume recording button","color","accent",3,"click",4,"ngIf"],["mat-raised-button","","aria-label","stop recording button","color","warn",3,"click",4,"ngIf"],["class","flex-display flex-row-flow flex-align-center",4,"ngIf"],[1,"error"],[1,"flex-display","recoder-options"],[3,"change"],["mat-stroked-button","","aria-label","start recording button","color","primary",3,"click"],["mat-stroked-button","","aria-label","pause recording button","color","warn",3,"click"],["mat-stroked-button","","aria-label","resume recording button","color","accent",3,"click"],["mat-raised-button","","aria-label","stop recording button","color","warn",3,"click"],[1,"flex-display","flex-row-flow","flex-align-center"],["color","primary","diameter","30",2,"margin-right","10px"],[1,"bold-text"]],template:function(o,r){1&o&&(e.TgZ(0,"div",0),e._UZ(1,"app-header-toolbar"),e.TgZ(2,"div",1)(3,"div",2),e._UZ(4,"app-tool-heading")(5,"app-share-buttons",3),e.TgZ(6,"div",4)(7,"div",5),e._UZ(8,"mat-icon",6),e.qZA(),e.YNc(9,te,2,0,"span",7),e.YNc(10,oe,5,0,"section",8),e.TgZ(11,"div",9),e.YNc(12,ne,4,0,"button",10),e.YNc(13,ie,4,0,"button",11),e.YNc(14,re,4,0,"button",12),e.YNc(15,ae,4,0,"button",13),e.qZA(),e.YNc(16,se,4,0,"div",14),e.qZA(),e._UZ(17,"app-related-tools",3)(18,"app-description",3)(19,"app-tags")(20,"app-follow-buttons"),e.qZA(),e._UZ(21,"app-footer"),e.qZA()()),2&o&&(e.xp6(9),e.Q6J("ngIf",!r.isSupported),e.xp6(1),e.Q6J("ngIf",r.isSupported),e.xp6(2),e.Q6J("ngIf",!r.isRecording&&!r.isProcessingStream&&r.isSupported),e.xp6(1),e.Q6J("ngIf",r.isRecording&&!r.isRecPaused),e.xp6(1),e.Q6J("ngIf",r.isRecording&&r.isRecPaused),e.xp6(1),e.Q6J("ngIf",r.isRecording&&!r.isProcessingStream&&r.isSupported),e.xp6(1),e.Q6J("ngIf",r.isProcessingStream))},dependencies:[c.O5,K.u,Y.O,D.Hw,N.lW,P.oG,Z.Ou,z.z,Q.d,$.o,X.c,q.c,ee.w],styles:[".icon-div[_ngcontent-%COMP%]{height:300px}.icon-div[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:scale(10)}.error[_ngcontent-%COMP%]{color:red;font-size:large;font-style:italic;font-weight:700}@media screen and (max-width: 735px){.icon-div[_ngcontent-%COMP%]{height:150px}.icon-div[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:scale(5)}.recoder-options[_ngcontent-%COMP%]{flex-direction:column}.error[_ngcontent-%COMP%]{font-size:small}}"]}),s})()}];let de=(()=>{var i;class s{}return(i=s).\u0275fac=function(o){return new(o||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[g.Bz.forChild(ce),g.Bz]}),s})();var le=a(8369),ue=a(6861),he=a(3665),me=a(6122),pe=a(300),ge=a(4485),fe=a(8292),ve=a(3341);let Se=(()=>{var i;class s{}return(i=s).\u0275fac=function(o){return new(o||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[c.ez,de,fe.K,ve.l,D.Ps,N.ot,P.p9,Z.Cq,le.b,ue.E,he.I,me._,pe.K,ge.E]}),s})()},6636:(E,v,a)=>{"use strict";a.d(v,{o:()=>g,x:()=>c});var c=function(n){return n.VIDEO_CONVERTER="Video Converter",n.SCREEN_RECORDER="Screen Recorder",n.TEXT_COMPARE="Text File Difference",n.UUID_GENERATOR="UUID Generator",n.JWT_DECODER="JWT Decoder",n.IMAGE_COMPRESSOR="Image Compressor",n.JS_FORMATTER="Javascript Formatter",n.JSON_FORMATTER="JSON Formatter",n.HTML_FORMATTER="HTML Formatter",n.CSS_FORMATTER="CSS Formatter",n.JSON_VIEWER="JSON Viewer",n.PASSWORD_GENERATOR="Password Generator",n.BASE64_ENCODE="Base64 Encode",n.BASE64_DECODE="Base64 Decode",n}(c||{});const g=[{applicationId:"passwordgenerator",displayText:c.PASSWORD_GENERATOR,iconName:"password-icon",navigateUrl:"/tools/password-generator"},{applicationId:"videoconverter",displayText:c.VIDEO_CONVERTER,iconName:"video-convert-icon",navigateUrl:"/tools/video-converter"},{applicationId:"screen-recorder",displayText:c.SCREEN_RECORDER,iconName:"screen-icon",navigateUrl:"/tools/screen-recorder"},{applicationId:"textcompare",displayText:c.TEXT_COMPARE,iconName:"comparison-icon",navigateUrl:"/tools/text-compare"},{applicationId:"uuid",displayText:c.UUID_GENERATOR,iconName:"uuid-icon",navigateUrl:"/tools/uuid"},{applicationId:"jwt",displayText:c.JWT_DECODER,iconName:"jwt-icon",navigateUrl:"/tools/jwt"},{applicationId:"imagecompress",displayText:c.IMAGE_COMPRESSOR,iconName:"image-compress-icon",navigateUrl:"/tools/image-compress"},{applicationId:"jsformatter",displayText:c.JS_FORMATTER,iconName:"js-icon",navigateUrl:"/tools/js-formatter"},{applicationId:"jsonformatter",displayText:c.JSON_FORMATTER,iconName:"json-icon",navigateUrl:"/tools/json-formatter"},{applicationId:"jsonviewer",displayText:c.JSON_VIEWER,iconName:"json-icon",navigateUrl:"/tools/json-viewer"},{applicationId:"htmlformatter",displayText:c.HTML_FORMATTER,iconName:"html-icon",navigateUrl:"/tools/html-formatter"},{applicationId:"cssformatter",displayText:c.CSS_FORMATTER,iconName:"css-icon",navigateUrl:"/tools/css-formatter"},{applicationId:"base64encoder",displayText:c.BASE64_ENCODE,iconName:"file-encode-icon",navigateUrl:"/tools/base64-encode"},{applicationId:"base64decoder",displayText:c.BASE64_DECODE,iconName:"file-decode-icon",navigateUrl:"/tools/base64-decode"}]},1273:function(E){E.exports=function(){"use strict";var v={d:function(g,n){for(var e in n)v.o(n,e)&&!v.o(g,e)&&Object.defineProperty(g,e,{enumerable:!0,get:n[e]})},o:function(g,n){return Object.prototype.hasOwnProperty.call(g,n)},r:function(g){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})}},a={};v.r(a),v.d(a,{VideoStreamMerger:function(){return c}});class c{constructor(n){this.width=720,this.height=405,this.fps=25,this._streams=[],this._frameCount=0,this.clearRect=!0,this.started=!1,this.result=null,this.supported=null,this._canvas=null,this._ctx=null,this._videoSyncDelayNode=null,this._audioDestination=null,this._audioCtx=null;const e=window.AudioContext||window.webkitAudioContext,t=!(!window.AudioContext||!(new e).createMediaStreamDestination),d=!!document.createElement("canvas").captureStream;if(!(this.supported=t&&d))return;this.setOptions(n);const u=this._audioCtx=new e,f=this._audioDestination=u?.createMediaStreamDestination();this._videoSyncDelayNode=u.createDelay(5),this._videoSyncDelayNode.connect(f),this._setupConstantNode(),this.started=!1,this.result=null,this._backgroundAudioHack()}setOptions(n){this._audioCtx=(n=n||{}).audioContext||new AudioContext,this.width=n.width||this.width,this.height=n.height||this.width,this.fps=n.fps||this.fps,this.clearRect=void 0===n.clearRect||n.clearRect}setOutputSize(n,e){this.width=n,this.height=e,this._canvas&&(this._canvas.setAttribute("width",this.width.toString()),this._canvas.setAttribute("height",this.height.toString()))}getAudioContext(){return this._audioCtx}getAudioDestination(){return this._audioDestination}getCanvasContext(){return this._ctx}_backgroundAudioHack(){if(this._audioCtx){const n=this._createConstantSource(),e=this._audioCtx.createGain();e&&n&&(e.gain.value=.001,n.connect(e),e.connect(this._audioCtx.destination),n.start())}}_setupConstantNode(){if(this._audioCtx&&this._videoSyncDelayNode){const n=this._createConstantSource();if(n){n.start();const e=this._audioCtx.createGain();e.gain.value=0,n.connect(e),e.connect(this._videoSyncDelayNode)}}}_createConstantSource(){if(this._audioCtx){if(this._audioCtx.createConstantSource)return this._audioCtx.createConstantSource();const n=this._audioCtx.createBufferSource(),e=this._audioCtx.createBuffer(1,1,this._audioCtx.sampleRate);return e.getChannelData(0)[0]=10,n.buffer=e,n.loop=!0,n}}updateIndex(n,e){"string"==typeof n&&(n={id:n}),e=e??0;for(let t=0;t<this._streams.length;t++)n.id===this._streams[t].id&&(this._streams[t].index=e);this._sortStreams()}_sortStreams(){this._streams=this._streams.sort((n,e)=>n.index-e.index)}addMediaElement(n,e,t){if((t=t||{}).x=t.x||0,t.y=t.y||0,t.width=t.width||this.width,t.height=t.height||this.height,t.mute=t.mute||t.muted||!1,t.oldDraw=t.draw,t.oldAudioEffect=t.audioEffect,t.draw=e instanceof HTMLVideoElement||e instanceof HTMLImageElement?(d,u,f)=>{t.oldDraw?t.oldDraw(d,e,f):(d.drawImage(e,t.x,t.y,null==t.width?this.width:t.width,null==t.height?this.height:t.height),f())}:null,this._audioCtx&&!t.mute){const d=e._mediaElementSource||this._audioCtx.createMediaElementSource(e);e._mediaElementSource=d,d.connect(this._audioCtx.destination);const u=this._audioCtx.createGain();d.connect(u),(e instanceof HTMLVideoElement||e instanceof HTMLAudioElement)&&e.muted?(e.muted=!1,e.volume=.001,u.gain.value=1e3):u.gain.value=1,t.audioEffect=(f,h)=>{t.oldAudioEffect?t.oldAudioEffect(u,h):u.connect(h)},t.oldAudioEffect=null}this.addStream(n,t)}addStream(n,e){if("string"==typeof n)return this._addData(n,e);const t={isData:!1};t.x=(e=e||{}).x||0,t.y=e.y||0,t.width=e.width,t.height=e.height,t.draw=e.draw||null,t.mute=e.mute||e.muted||!1,t.audioEffect=e.audioEffect||null,t.index=null==e.index?0:e.index,t.hasVideo=n.getVideoTracks().length>0,t.hasAudio=n.getAudioTracks().length>0;let d=null;for(let u=0;u<this._streams.length;u++)this._streams[u].id===n.id&&(d=this._streams[u].element);d||(d=document.createElement("video"),d.autoplay=!0,d.muted=!0,d.playsInline=!0,d.srcObject=n,d.setAttribute("style","position:fixed; left: 0px; top:0px; pointer-events: none; opacity:0;"),document.body.appendChild(d),d.play().catch(null),t.hasAudio&&this._audioCtx&&!t.mute&&(t.audioSource=this._audioCtx.createMediaStreamSource(n),t.audioOutput=this._audioCtx.createGain(),t.audioOutput.gain.value=1,t.audioEffect?t.audioEffect(t.audioSource,t.audioOutput):t.audioSource.connect(t.audioOutput),t.audioOutput.connect(this._videoSyncDelayNode))),t.element=d,t.id=n.id||null,this._streams.push(t),this._sortStreams()}removeStream(n){"string"==typeof n&&(n={id:n});for(let e=0;e<this._streams.length;e++){const t=this._streams[e];n.id===t.id&&(t.audioSource&&(t.audioSource=null),t.audioOutput&&(t.audioOutput.disconnect(this._videoSyncDelayNode),t.audioOutput=null),t.element&&t.element.remove(),this._streams[e]=null,this._streams.splice(e,1),e--)}}_addData(n,e){const t={isData:!0};t.draw=(e=e||{}).draw||null,t.audioEffect=e.audioEffect||null,t.id=n,t.element=null,t.index=null==e.index?0:e.index,this._videoSyncDelayNode&&this._audioCtx&&t.audioEffect&&(t.audioOutput=this._audioCtx.createGain(),t.audioOutput.gain.value=1,t.audioEffect(null,t.audioOutput),t.audioOutput.connect(this._videoSyncDelayNode)),this._streams.push(t),this._sortStreams()}_requestAnimationFrame(n){let e=!1;const t=setInterval(()=>{!e&&document.hidden&&(e=!0,clearInterval(t),n())},1e3/this.fps);requestAnimationFrame(()=>{e||(e=!0,clearInterval(t),n())})}start(){var n,e,t,d,u;this._canvas=document.createElement("canvas"),this._canvas.setAttribute("width",this.width.toString()),this._canvas.setAttribute("height",this.height.toString()),this._canvas.setAttribute("style","position:fixed; left: 110%; pointer-events: none"),this._ctx=this._canvas.getContext("2d"),this.started=!0,this._requestAnimationFrame(this._draw.bind(this)),this.result=(null===(n=this._canvas)||void 0===n?void 0:n.captureStream(this.fps))||null;const f=null===(e=this.result)||void 0===e?void 0:e.getAudioTracks()[0];f&&(null===(t=this.result)||void 0===t||t.removeTrack(f));const h=null===(d=this._audioDestination)||void 0===d?void 0:d.stream.getAudioTracks();h&&h.length&&(null===(u=this.result)||void 0===u||u.addTrack(h[0]))}_updateAudioDelay(n){this._videoSyncDelayNode&&this._audioCtx&&this._videoSyncDelayNode.delayTime.setValueAtTime(n/1e3,this._audioCtx.currentTime)}_draw(){var n;if(!this.started)return;this._frameCount++;let e=0;this._frameCount%60==0&&(e=performance.now());let t=this._streams.length;const d=()=>{if(t--,t<=0){if(this._frameCount%60==0){const u=performance.now();this._updateAudioDelay(u-e)}this._requestAnimationFrame(this._draw.bind(this))}};this.clearRect&&(null===(n=this._ctx)||void 0===n||n.clearRect(0,0,this.width,this.height)),this._streams.forEach(u=>{u.draw?u.draw(this._ctx,u.element,d):(!u.isData&&u.hasVideo&&this._drawVideo(u.element,u),d())}),0===this._streams.length&&d()}_drawVideo(n,e){var t;const f=e.height||this.height,h=e.width||this.width;let x=e.x||0,_=e.y||0;try{null===(t=this._ctx)||void 0===t||t.drawImage(n,x,_,h,f)}catch(C){console.error(C)}}stop(){var n,e;this.started=!1,this._canvas=null,this._ctx=null,this._streams.forEach(t=>{t.element&&t.element.remove()}),this._streams=[],null===(n=this._audioCtx)||void 0===n||n.close(),this._audioCtx=null,this._audioDestination=null,this._videoSyncDelayNode=null,null===(e=this.result)||void 0===e||e.getTracks().forEach(t=>{t.stop()}),this.result=null}destroy(){this.stop()}}return typeof window<"u"&&(window.VideoStreamMerger=c),a}()}}]);