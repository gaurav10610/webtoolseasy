(self.webpackChunkwebtoolseasy=self.webpackChunkwebtoolseasy||[]).push([[301],{4301:(I,y,d)=>{"use strict";d.r(y),d.d(y,{ScreenRecorderModule:()=>xe});var x=d(6814),f=d(3403),i=d(5861),e=d(5879),t=d(7294),c=d(3242),l=d(553),g=d(6636);const m="/tools/screen-recorder",C="Free Online Screen Recorder | Online Video Recorder",b="Easily Capture your Screen via Best Free Online Screen Recorder with or without audio, video from microphone and webcam | No download, No Watermark with Lag free recording for PCs ( Windows/ MAC/ Ubuntu )",R=`${l.N.screenshotsBaseUrl}/screen-recorder.png`,w={mainHeading:"Online Screen Recorder",subHeading:"Record Screen With Audio, Video for Free",navigationUrl:m,pageTitle:C,metaTags:[{name:"description",content:b},{name:"author",content:"Gaurav Kumar Yadav"},{name:"robots",content:"index, follow"},{property:"og:title",content:C},{property:"og:type",content:"website"},{property:"og:url",content:`${l.N.hostname}${m}`},{property:"og:image",content:R},{property:"og:image:secure_url",content:R},{property:"og:description",content:b},{property:"og:site_name",content:"WebToolsEasy"}],tags:["screen recorder","screen capture","screen record on mac","screen recorder windows 10","windows screen recorder"],icons:[{iconName:"app-icon",iconRelativeUrl:"app-icon.svg"},{iconName:"screen-icon",iconRelativeUrl:"screen.svg"},{iconName:"video-convert-icon",iconRelativeUrl:"video-convert.svg"},{iconName:"share-fb",iconRelativeUrl:"share-fb.svg"},{iconName:"share-linkedin",iconRelativeUrl:"share-linkedin.svg"},{iconName:"share-twitter",iconRelativeUrl:"share-twitter.svg"},{iconName:"share-copy",iconRelativeUrl:"share-copy.svg"},{iconName:"home-icon",iconRelativeUrl:"home.svg"}],relatedTools:[{applicationId:"videoconverter",displayText:g.x.VIDEO_CONVERTER,iconName:"video-convert-icon",navigateUrl:"/tools/video-converter"}]},V=[{heading:"How to use Screen Recorder?",listData:["To include mic audio & camera video in the recorded video, use provided checkboxes.","Start screen recording using start recording button.","When asked for mic & camera permission then provide the same.","Camera video if included will appear at bottom right corner in the recorded video in 150X150 px box.","Screen recording can be stopped via native stop recording button or use stop recording button on the screen (button will appear once recording starts).","Once recording is stopped then recorded video will be downloaded automatically."]},{heading:"Key features",listData:["Screen recording is 100% free.","Unlimited screen recording in HD format.","Record screen with camera video & mic audio.","No watermark in the recorded video.","Easy to use: No software installation is needed to record screen.","Cross platform: tool is completely web-based and can be accessed wherever you are, from any computer. It is compatible with all major browsers and OSes, including Windows, macOS, and Linux.","Secure: Screen recording is 100% secure as whole processing is being done at client side only (in host browser) and we don't store any video."]},{heading:"Disclaimer",blockData:["Recorded video will be in WEBM format. To convert in some other format like MP4 you can use our video converter tool to convert the recorded video."]}];function h(n){return new Promise((a,s)=>{n.oncomplete=n.onsuccess=()=>a(n.result),n.onabort=n.onerror=()=>s(n.error)})}let _;function v(){return _||(_=function j(n,a){const s=indexedDB.open(n);s.onupgradeneeded=()=>s.result.createObjectStore(a);const o=h(s);return(r,u)=>o.then(p=>u(p.transaction(a,r).objectStore(a)))}("keyval-store","keyval")),_}function H(n,a=v()){return a("readonly",s=>h(s.get(n)))}function M(n=v()){return n("readwrite",a=>(a.clear(),h(a.transaction)))}var Y=d(1273),T=d(1088),G=d(8645),L=d(9773),J=d(6179),O=d(6593),E=d(617),z=d(5282),K=d(4346),B=d(3109),N=d(2296),k=d(5986),P=d(5940),W=d(1006),Q=d(1294),$=d(5559),X=d(7913),q=d(7881),ee=d(1552);const te=["timer"];function oe(n,a){1&n&&(e.TgZ(0,"span",16),e._uU(1,"screen capturing is not supported by host browser"),e.qZA())}function ie(n,a){if(1&n){const s=e.EpF();e.TgZ(0,"section",17)(1,"mat-checkbox",18),e.NdJ("change",function(r){e.CHM(s);const u=e.oxw();return e.KtG(u.recorderOptionChange(r,"mic-audio"))}),e._uU(2,"include mic audio"),e.qZA(),e.TgZ(3,"mat-checkbox",18),e.NdJ("change",function(r){e.CHM(s);const u=e.oxw();return e.KtG(u.recorderOptionChange(r,"camera-video"))}),e._uU(4,"include camera video"),e.qZA()()}}function ne(n,a){if(1&n){const s=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(s);const r=e.oxw();return e.KtG(r.startRecording())}),e.TgZ(1,"mat-icon"),e._uU(2,"play_arrow"),e.qZA(),e._uU(3," Start Recording "),e.qZA()}}function re(n,a){if(1&n){const s=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(s);const r=e.oxw();return e.KtG(r.pauseRecording())}),e.TgZ(1,"mat-icon"),e._uU(2,"pause"),e.qZA(),e._uU(3," Pause Recording "),e.qZA()}}function ae(n,a){if(1&n){const s=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){e.CHM(s);const r=e.oxw();return e.KtG(r.resumeRecording())}),e.TgZ(1,"mat-icon"),e._uU(2,"play_arrow"),e.qZA(),e._uU(3," Resume Recording "),e.qZA()}}function se(n,a){if(1&n){const s=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(s);const r=e.oxw();return e.KtG(r.stopRecording())}),e.TgZ(1,"mat-icon"),e._uU(2,"stop"),e.qZA(),e._uU(3," Stop Recording "),e.qZA()}}function ce(n,a){1&n&&(e.TgZ(0,"span",23,24),e._uU(2,"00:00"),e.qZA())}function de(n,a){1&n&&(e.TgZ(0,"div",25),e._UZ(1,"mat-spinner",26),e.TgZ(2,"span",27),e._uU(3,"preparing video file to download"),e.qZA()())}const le=[{path:"",component:(()=>{var n;class a extends t.H{constructor(o,r,u,p,S,D,Z,Ce,U,we){super(),this.titleService=o,this.metaService=r,this.document=u,this.matIconRegistry=p,this.domSanitizer=S,this.platformId=D,this.renderer=Z,this.zoneRef=Ce,this.breakpointObserver=U,this.appContextService=we,this.appId="imagecompress",this.isRecording=!1,this.isProcessingStream=!1,this.isRecPaused=!1,this.timeCounter=0,this.videoFileExtention="webm",this.recorderOptionConfig={webm:{mimeType:"video/webm; codecs=vp9"},mp4:{mimeType:"video/mp4"}},this.cameraVideoOptions={width:150,height:150},this.includeScreenAudio=!1,this.includeMicAudio=!1,this.includeCameraVideo=!1,this.videoChunksCounter=0,this.showMergedVideo=!1,this.isSupported=!0,this.destroyed=new G.x,this.loadCustomIcons(w.icons,this.matIconRegistry,this.domSanitizer,this.platformId,this.appContextService),this.updatePageMetaData(w,this.titleService,this.metaService,this.document),this.appContextService.tags=w.tags,this.appContextService.mainHeading=w.mainHeading,this.appContextService.subHeading=w.subHeading,this.appContextService.relatedTools=w.relatedTools,this.appContextService.descrptionData=V,this.breakpointObserver.observe([T.u3.Handset,T.u3.Web]).pipe((0,L.R)(this.destroyed)).subscribe(Ze=>{this.isMobile=U.isMatched(`(max-width: ${J.U})`),this.checkCompatibility()}),this.checkCompatibility()}checkCompatibility(){l.N.production&&(this.isSupported=!this.isMobile)}ngOnDestroy(){(0,x.NF)(this.platformId)&&M(),this.destroyed.next(),this.destroyed.complete()}ngOnInit(){c.j.info("screen recorder component: ngOnInit")}ngAfterViewInit(){c.j.info("screen recorder component: ngAfterViewInit")}resetContextVariables(){this.screenStream=void 0,this.webcamStream=void 0,this.mergedMediaStream=void 0,this.mediaStreamRecorder=void 0,this.videoChunksCounter=0}startRecording(){var o=this;this.zoneRef.run((0,i.Z)(function*(){o.resetContextVariables(),o.renderer.setProperty(o.timer.nativeElement,"textContent","00:00"),yield M();try{o.screenStream=yield o.getScreenStream(),c.j.info(`screen stream dimensions: ${o.getVideoStreamHeightWidth(o.screenStream)}`),o.configureStreamStopListener(o.screenStream),o.isRecording=!0}catch(r){c.j.error("error occured while capturing screen stream"),c.j.error(r),o.stopRecording()}try{(o.includeMicAudio||o.includeCameraVideo)&&(o.webcamStream=yield o.getCameraAndMicStream(),o.configureStreamStopListener(o.webcamStream))}catch(r){c.j.error("error occured while capturing camera or mic media stream"),c.j.error(r),o.stopRecording()}o.webcamStream?(o.mergedMediaStream=o.mergeMediaStreams(o.screenStream,o.webcamStream),o.mergedMediaStream||(c.j.error("error encountered while merging media streams"),o.stopRecording())):o.mergedMediaStream=o.screenStream,o.mergedMediaStream&&o.configureStreamRecorder(o.mergedMediaStream)}))}configureStreamStopListener(o){o.getTracks().forEach(r=>{r.addEventListener("ended",u=>{c.j.info("media stream track has ended"),this.isRecording&&this.stopRecording()})})}mergeMediaStreams(o,r){const u=this.screenStream?.getVideoTracks()[0].getSettings();let S=new Y.VideoStreamMerger({width:u.width,height:u.height});return S.addStream(o,{x:0,y:0,width:S.width,height:S.height,mute:!0,index:0}),S.addStream(r,{x:S.width-this.cameraVideoOptions.width,y:S.height-this.cameraVideoOptions.height,width:this.cameraVideoOptions.width,height:this.cameraVideoOptions.height,mute:!1,index:1}),S.start(),S.result}configureStreamRecorder(o){c.j.info("configuring media stream recorder"),this.mediaStreamRecorder=new MediaRecorder(o,this.recorderOptionConfig[this.videoFileExtention]),this.mediaStreamRecorder.ondataavailable=r=>{this.videoChunksCounter++,this.timeCounter=this.timeCounter+50;let u=new Date(0);u.setSeconds(this.timeCounter/1e3),this.renderer.setProperty(this.timer.nativeElement,"textContent",u.toISOString().substring(11,19)),function F(n,a,s=v()){s("readwrite",o=>(o.put(a,n),h(o.transaction)))}(this.videoChunksCounter,r.data)},this.mediaStreamRecorder.start(a.RECORDER_TIME_SLICE_MS)}getScreenStream(){var o=this;return(0,i.Z)(function*(){const r={video:!0,audio:!1};return o.includeScreenAudio&&(r.audio=!0),navigator.mediaDevices.getDisplayMedia(r)})()}getCameraAndMicStream(){var o=this;return(0,i.Z)(function*(){return navigator.mediaDevices.getUserMedia({video:o.includeCameraVideo,audio:o.includeMicAudio})})()}pauseRecording(){this.mediaStreamRecorder?.pause(),this.isRecPaused=!0}resumeRecording(){this.mediaStreamRecorder?.resume(),this.isRecPaused=!1}stopRecording(){this.mediaStreamRecorder?.stop(),this.screenStream?.getTracks().forEach(o=>o.stop()),this.webcamStream?.getTracks().forEach(o=>o.stop()),this.mergedMediaStream?.getTracks().forEach(o=>o.stop()),this.screenStream&&this.mergedMediaStream&&this.processMediaStream(),this.isRecording=!1}processMediaStream(){var o=this;this.isProcessingStream=!0,setTimeout((0,i.Z)(function*(){try{const r=[];for(let u=0;u<o.videoChunksCounter;u++)r.push(yield H(u));yield o.downloadVideoFile("recorded-video-file.webm",new Blob(r,{type:"video/webm"})),o.zoneRef.run(()=>o.isProcessingStream=!1),M()}catch(r){c.j.info("error occured while preparing video file for download"),c.j.error(r),o.zoneRef.run(()=>o.isProcessingStream=!1)}}),a.RECORDING_START_DELAY_MS)}recorderOptionChange(o,r){switch(c.j.info(`recorder option changed: ${r}`),r){case"mic-audio":this.includeMicAudio=o.checked;break;case"camera-video":this.includeCameraVideo=o.checked}}downloadVideoFile(o,r){var u=this;return(0,i.Z)(function*(){const p=u.renderer.createElement("a");u.renderer.setProperty(p,"href",URL.createObjectURL(r)),u.renderer.setProperty(p,"download",o),p.click()})()}getVideoStreamHeightWidth(o){if(o.getVideoTracks().length>0){const r=o.getVideoTracks()[0].getSettings();return`[ height: ${r.height}, width: ${r.width} ]`}return""}}return(n=a).RECORDING_START_DELAY_MS=5e3,n.RECORDER_TIME_SLICE_MS=50,n.\u0275fac=function(o){return new(o||n)(e.Y36(O.Dx),e.Y36(O.h_),e.Y36(x.K0),e.Y36(E.jv),e.Y36(O.H7),e.Y36(e.Lbi),e.Y36(e.Qsj),e.Y36(e.R0b),e.Y36(T.Yg),e.Y36(z.i))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-screen-recorder"]],viewQuery:function(o,r){if(1&o&&e.Gf(te,5),2&o){let u;e.iGM(u=e.CRH())&&(r.timer=u.first)}},features:[e.qOj],decls:23,vars:8,consts:[[1,"full-height","flex-display","flex-column-flow","no-y-scroll"],[1,"full-width","y-scroll"],[1,"flex-display","flex-column-flow","flex-align-center","base-app-container"],[1,"full-width"],[1,"flex-display","flex-column-flow","flex-align-center","full-width",2,"margin-bottom","20px"],[1,"flex-display","flex-column-flow","flex-center","flex-align-center","full-width","icon-div"],["svgIcon","screen-icon"],["class","error",4,"ngIf"],["style","margin-bottom: 10px","class","flex-display recoder-options",4,"ngIf"],[1,"flex-display","flex-row-flow",2,"gap","10px"],["mat-stroked-button","","aria-label","start recording button","color","primary",3,"click",4,"ngIf"],["mat-stroked-button","","aria-label","pause recording button","color","warn",3,"click",4,"ngIf"],["mat-stroked-button","","aria-label","resume recording button","color","accent",3,"click",4,"ngIf"],["mat-raised-button","","aria-label","stop recording button","color","warn",3,"click",4,"ngIf"],["class","timer",4,"ngIf"],["class","flex-display flex-row-flow flex-align-center",4,"ngIf"],[1,"error"],[1,"flex-display","recoder-options",2,"margin-bottom","10px"],[3,"change"],["mat-stroked-button","","aria-label","start recording button","color","primary",3,"click"],["mat-stroked-button","","aria-label","pause recording button","color","warn",3,"click"],["mat-stroked-button","","aria-label","resume recording button","color","accent",3,"click"],["mat-raised-button","","aria-label","stop recording button","color","warn",3,"click"],[1,"timer"],["timer",""],[1,"flex-display","flex-row-flow","flex-align-center"],["color","primary","diameter","30",2,"margin-right","10px"],[1,"bold-text"]],template:function(o,r){1&o&&(e.TgZ(0,"div",0),e._UZ(1,"app-header-toolbar"),e.TgZ(2,"div",1)(3,"div",2),e._UZ(4,"app-tool-heading")(5,"app-share-buttons",3),e.TgZ(6,"div",4)(7,"div",5),e._UZ(8,"mat-icon",6),e.qZA(),e.YNc(9,oe,2,0,"span",7),e.YNc(10,ie,5,0,"section",8),e.TgZ(11,"div",9),e.YNc(12,ne,4,0,"button",10),e.YNc(13,re,4,0,"button",11),e.YNc(14,ae,4,0,"button",12),e.YNc(15,se,4,0,"button",13),e.qZA(),e.YNc(16,ce,3,0,"span",14),e.YNc(17,de,4,0,"div",15),e._UZ(18,"app-related-tools",3)(19,"app-description",3),e.qZA(),e._UZ(20,"app-tags")(21,"app-follow-buttons"),e.qZA(),e._UZ(22,"app-footer"),e.qZA()()),2&o&&(e.xp6(9),e.Q6J("ngIf",!r.isSupported),e.xp6(1),e.Q6J("ngIf",r.isSupported),e.xp6(2),e.Q6J("ngIf",!r.isRecording&&!r.isProcessingStream&&r.isSupported),e.xp6(1),e.Q6J("ngIf",r.isRecording&&!r.isRecPaused),e.xp6(1),e.Q6J("ngIf",r.isRecording&&r.isRecPaused),e.xp6(1),e.Q6J("ngIf",r.isRecording&&!r.isProcessingStream&&r.isSupported),e.xp6(1),e.Q6J("ngIf",r.isSupported),e.xp6(1),e.Q6J("ngIf",r.isProcessingStream))},dependencies:[x.O5,K.u,B.O,E.Hw,N.lW,k.oG,P.Ou,W.z,Q.d,$.o,X.c,q.c,ee.w],styles:[".icon-div[_ngcontent-%COMP%]{height:300px}.icon-div[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:scale(10)}.timer[_ngcontent-%COMP%]{margin-top:20px;font-size:xx-large;color:red}.error[_ngcontent-%COMP%]{color:red;font-size:large;font-style:italic;font-weight:700}.description[_ngcontent-%COMP%]{margin-top:20px}@media screen and (min-width: 735px){.description[_ngcontent-%COMP%]{margin:20px}}@media screen and (max-width: 735px){.icon-div[_ngcontent-%COMP%]{height:150px}.icon-div[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:scale(5)}.timer[_ngcontent-%COMP%]{font-size:x-large}.recoder-options[_ngcontent-%COMP%]{flex-direction:column}.error[_ngcontent-%COMP%]{font-size:small}}"]}),a})()}];let ue=(()=>{var n;class a{}return(n=a).\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[f.Bz.forChild(le),f.Bz]}),a})();var he=d(8369),me=d(6861),pe=d(3665),ge=d(6122),fe=d(300),ve=d(4485),Se=d(8292),ye=d(3341);let xe=(()=>{var n;class a{}return(n=a).\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[x.ez,ue,Se.K,ye.l,E.Ps,N.ot,k.p9,P.Cq,he.b,me.E,pe.I,ge._,fe.K,ve.E]}),a})()},1273:function(I){I.exports=function(){"use strict";var y={d:function(f,i){for(var e in i)y.o(i,e)&&!y.o(f,e)&&Object.defineProperty(f,e,{enumerable:!0,get:i[e]})},o:function(f,i){return Object.prototype.hasOwnProperty.call(f,i)},r:function(f){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(f,"__esModule",{value:!0})}},d={};y.r(d),y.d(d,{VideoStreamMerger:function(){return x}});class x{constructor(i){this.width=720,this.height=405,this.fps=25,this._streams=[],this._frameCount=0,this.clearRect=!0,this.started=!1,this.result=null,this.supported=null,this._canvas=null,this._ctx=null,this._videoSyncDelayNode=null,this._audioDestination=null,this._audioCtx=null;const e=window.AudioContext||window.webkitAudioContext,t=!(!window.AudioContext||!(new e).createMediaStreamDestination),c=!!document.createElement("canvas").captureStream;if(!(this.supported=t&&c))return;this.setOptions(i);const l=this._audioCtx=new e,g=this._audioDestination=l?.createMediaStreamDestination();this._videoSyncDelayNode=l.createDelay(5),this._videoSyncDelayNode.connect(g),this._setupConstantNode(),this.started=!1,this.result=null,this._backgroundAudioHack()}setOptions(i){this._audioCtx=(i=i||{}).audioContext||new AudioContext,this.width=i.width||this.width,this.height=i.height||this.width,this.fps=i.fps||this.fps,this.clearRect=void 0===i.clearRect||i.clearRect}setOutputSize(i,e){this.width=i,this.height=e,this._canvas&&(this._canvas.setAttribute("width",this.width.toString()),this._canvas.setAttribute("height",this.height.toString()))}getAudioContext(){return this._audioCtx}getAudioDestination(){return this._audioDestination}getCanvasContext(){return this._ctx}_backgroundAudioHack(){if(this._audioCtx){const i=this._createConstantSource(),e=this._audioCtx.createGain();e&&i&&(e.gain.value=.001,i.connect(e),e.connect(this._audioCtx.destination),i.start())}}_setupConstantNode(){if(this._audioCtx&&this._videoSyncDelayNode){const i=this._createConstantSource();if(i){i.start();const e=this._audioCtx.createGain();e.gain.value=0,i.connect(e),e.connect(this._videoSyncDelayNode)}}}_createConstantSource(){if(this._audioCtx){if(this._audioCtx.createConstantSource)return this._audioCtx.createConstantSource();const i=this._audioCtx.createBufferSource(),e=this._audioCtx.createBuffer(1,1,this._audioCtx.sampleRate);return e.getChannelData(0)[0]=10,i.buffer=e,i.loop=!0,i}}updateIndex(i,e){"string"==typeof i&&(i={id:i}),e=e??0;for(let t=0;t<this._streams.length;t++)i.id===this._streams[t].id&&(this._streams[t].index=e);this._sortStreams()}_sortStreams(){this._streams=this._streams.sort((i,e)=>i.index-e.index)}addMediaElement(i,e,t){if((t=t||{}).x=t.x||0,t.y=t.y||0,t.width=t.width||this.width,t.height=t.height||this.height,t.mute=t.mute||t.muted||!1,t.oldDraw=t.draw,t.oldAudioEffect=t.audioEffect,t.draw=e instanceof HTMLVideoElement||e instanceof HTMLImageElement?(c,l,g)=>{t.oldDraw?t.oldDraw(c,e,g):(c.drawImage(e,t.x,t.y,null==t.width?this.width:t.width,null==t.height?this.height:t.height),g())}:null,this._audioCtx&&!t.mute){const c=e._mediaElementSource||this._audioCtx.createMediaElementSource(e);e._mediaElementSource=c,c.connect(this._audioCtx.destination);const l=this._audioCtx.createGain();c.connect(l),(e instanceof HTMLVideoElement||e instanceof HTMLAudioElement)&&e.muted?(e.muted=!1,e.volume=.001,l.gain.value=1e3):l.gain.value=1,t.audioEffect=(g,m)=>{t.oldAudioEffect?t.oldAudioEffect(l,m):l.connect(m)},t.oldAudioEffect=null}this.addStream(i,t)}addStream(i,e){if("string"==typeof i)return this._addData(i,e);const t={isData:!1};t.x=(e=e||{}).x||0,t.y=e.y||0,t.width=e.width,t.height=e.height,t.draw=e.draw||null,t.mute=e.mute||e.muted||!1,t.audioEffect=e.audioEffect||null,t.index=null==e.index?0:e.index,t.hasVideo=i.getVideoTracks().length>0,t.hasAudio=i.getAudioTracks().length>0;let c=null;for(let l=0;l<this._streams.length;l++)this._streams[l].id===i.id&&(c=this._streams[l].element);c||(c=document.createElement("video"),c.autoplay=!0,c.muted=!0,c.playsInline=!0,c.srcObject=i,c.setAttribute("style","position:fixed; left: 0px; top:0px; pointer-events: none; opacity:0;"),document.body.appendChild(c),c.play().catch(null),t.hasAudio&&this._audioCtx&&!t.mute&&(t.audioSource=this._audioCtx.createMediaStreamSource(i),t.audioOutput=this._audioCtx.createGain(),t.audioOutput.gain.value=1,t.audioEffect?t.audioEffect(t.audioSource,t.audioOutput):t.audioSource.connect(t.audioOutput),t.audioOutput.connect(this._videoSyncDelayNode))),t.element=c,t.id=i.id||null,this._streams.push(t),this._sortStreams()}removeStream(i){"string"==typeof i&&(i={id:i});for(let e=0;e<this._streams.length;e++){const t=this._streams[e];i.id===t.id&&(t.audioSource&&(t.audioSource=null),t.audioOutput&&(t.audioOutput.disconnect(this._videoSyncDelayNode),t.audioOutput=null),t.element&&t.element.remove(),this._streams[e]=null,this._streams.splice(e,1),e--)}}_addData(i,e){const t={isData:!0};t.draw=(e=e||{}).draw||null,t.audioEffect=e.audioEffect||null,t.id=i,t.element=null,t.index=null==e.index?0:e.index,this._videoSyncDelayNode&&this._audioCtx&&t.audioEffect&&(t.audioOutput=this._audioCtx.createGain(),t.audioOutput.gain.value=1,t.audioEffect(null,t.audioOutput),t.audioOutput.connect(this._videoSyncDelayNode)),this._streams.push(t),this._sortStreams()}_requestAnimationFrame(i){let e=!1;const t=setInterval(()=>{!e&&document.hidden&&(e=!0,clearInterval(t),i())},1e3/this.fps);requestAnimationFrame(()=>{e||(e=!0,clearInterval(t),i())})}start(){var i,e,t,c,l;this._canvas=document.createElement("canvas"),this._canvas.setAttribute("width",this.width.toString()),this._canvas.setAttribute("height",this.height.toString()),this._canvas.setAttribute("style","position:fixed; left: 110%; pointer-events: none"),this._ctx=this._canvas.getContext("2d"),this.started=!0,this._requestAnimationFrame(this._draw.bind(this)),this.result=(null===(i=this._canvas)||void 0===i?void 0:i.captureStream(this.fps))||null;const g=null===(e=this.result)||void 0===e?void 0:e.getAudioTracks()[0];g&&(null===(t=this.result)||void 0===t||t.removeTrack(g));const m=null===(c=this._audioDestination)||void 0===c?void 0:c.stream.getAudioTracks();m&&m.length&&(null===(l=this.result)||void 0===l||l.addTrack(m[0]))}_updateAudioDelay(i){this._videoSyncDelayNode&&this._audioCtx&&this._videoSyncDelayNode.delayTime.setValueAtTime(i/1e3,this._audioCtx.currentTime)}_draw(){var i;if(!this.started)return;this._frameCount++;let e=0;this._frameCount%60==0&&(e=performance.now());let t=this._streams.length;const c=()=>{if(t--,t<=0){if(this._frameCount%60==0){const l=performance.now();this._updateAudioDelay(l-e)}this._requestAnimationFrame(this._draw.bind(this))}};this.clearRect&&(null===(i=this._ctx)||void 0===i||i.clearRect(0,0,this.width,this.height)),this._streams.forEach(l=>{l.draw?l.draw(this._ctx,l.element,c):(!l.isData&&l.hasVideo&&this._drawVideo(l.element,l),c())}),0===this._streams.length&&c()}_drawVideo(i,e){var t;const g=e.height||this.height,m=e.width||this.width;let C=e.x||0,b=e.y||0;try{null===(t=this._ctx)||void 0===t||t.drawImage(i,C,b,m,g)}catch(R){console.error(R)}}stop(){var i,e;this.started=!1,this._canvas=null,this._ctx=null,this._streams.forEach(t=>{t.element&&t.element.remove()}),this._streams=[],null===(i=this._audioCtx)||void 0===i||i.close(),this._audioCtx=null,this._audioDestination=null,this._videoSyncDelayNode=null,null===(e=this.result)||void 0===e||e.getTracks().forEach(t=>{t.stop()}),this.result=null}destroy(){this.stop()}}return typeof window<"u"&&(window.VideoStreamMerger=x),d}()}}]);